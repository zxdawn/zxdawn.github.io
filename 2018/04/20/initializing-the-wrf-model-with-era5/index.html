<!doctype html><html lang=zn-hans><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no,maximum-scale=1"><meta name=author content="Xin Zhang"><meta name=description content="Note
This is the tutorial of using WRF with ERA5 model level (138 vertical levels) data.
If you prefer pressure level (38 vertical levels), please check another tutorial.
I recommend the pressure level data, because the download speed is much faster.
If you don’t have cdsapi, please check this official tutorial.
Summarization

Download
Preprocess
Automation
Geogrid
Ungrib
Produce additional intermediate files
Metgrid
"><meta property="og:title" content="Initializing the WRF model with ERA5"><meta property="og:description" content="Note
This is the tutorial of using WRF with ERA5 model level (138 vertical levels) data.
If you prefer pressure level (38 vertical levels), please check another tutorial.
I recommend the pressure level data, because the download speed is much faster.
If you don’t have cdsapi, please check this official tutorial.
Summarization

Download
Preprocess
Automation
Geogrid
Ungrib
Produce additional intermediate files
Metgrid
"><meta property="og:type" content="article"><meta property="og:url" content="https://zxdawn.github.io/2018/04/20/initializing-the-wrf-model-with-era5/"><meta property="article:section" content="sci-tech"><meta property="article:published_time" content="2018-04-20T00:00:00+00:00"><meta property="article:modified_time" content="2018-04-20T00:00:00+00:00"><title>Initializing the WRF model with ERA5 | Dreambooker</title><link rel=canonical href=https://zxdawn.github.io/2018/04/20/initializing-the-wrf-model-with-era5/><link href=https://zxdawn.github.io/vendors/fontawesome-free-5.14.0-web/css/all.min.css rel=stylesheet><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Ubuntu+Mono:400,400i,700,700i|Raleway:300,400,500,600"><link href=https://zxdawn.github.io/css/font.css rel=stylesheet><link href=https://zxdawn.github.io/css/vendors/bootstrap4/bootstrap.min.css rel=stylesheet><link href=https://zxdawn.github.io/css/vendors-extensions/mdb/mdb.min.css rel=stylesheet><link href=https://zxdawn.github.io/css/vendors/mdb/style.min.css rel=stylesheet><link href=https://zxdawn.github.io/css/main.css rel=stylesheet><link rel="shortcut icon" href=https://zxdawn.github.io/img/logo.jpg><style type=text/css>@media(min-width:800px) and (max-width:850px){.navbar:not(.top-nav-collapse){background:#1c2331!important}}</style><link rel=stylesheet href=https://zxdawn.github.io/css/vendors/highlight/github-gist.css></head><body class=bg-light data-spy=scroll data-target=#page-scrollspy data-offset=90><nav class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class=container><a class=navbar-brand href=https://zxdawn.github.io><img class=avatar src=https://zxdawn.github.io/img/logo.jpg style=width:40px!important;height:auto class="d-inline-block align-top" alt>
<strong>Xin Zhang</strong></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=https://zxdawn.github.io>Home</a></li><li class=nav-item><a class=nav-link href=https://zxdawn.github.io/sci-tech/>Sci-Tech</a></li><li class=nav-item><a class=nav-link href=https://zxdawn.github.io/essay/>Essay</a></li><li class=nav-item><a class=nav-link href=https://zxdawn.github.io/about/>About</a></li></ul></div></div></nav><div id=site-header class="carousel slide carousel-fade" data-ride=carousel style=height:18rem><div class=carousel-inner role=listbox><div class="carousel-item active"><div class=view style=background-image:url(https://zxdawn.github.io/img/header-slides/0.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://zxdawn.github.io/img/header-slides//1.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://zxdawn.github.io/img/header-slides//2.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://zxdawn.github.io/img/header-slides//3.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://zxdawn.github.io/img/header-slides//4.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div></div><div class="carousel-content text-center white-text wow fadeIn"><div class="row mx-0 headfont mt-3 pt-4"><div class="col-12 col-sm-5 align-middle"><a href=https://zxdawn.github.io><img class="pull-right avatar avatar-md" src=https://zxdawn.github.io/img/me.jpg alt></a></div><div class="col-12 col-sm-7 text-left pl-2"><a href=https://zxdawn.github.io><h1 class="mb-2 h1" style=font-weight:300><strong>Dreambooker</strong></h1></a><div class=mt-2 style=font-size:1rem;color:#fff><a href=//github.com/zxdawn target=_blank rel="noopener me"><i class="fab fa-github pr-1" aria-hidden=true></i></a>
<a href=//twitter.com/zhangxin_dawn target=_blank rel="noopener me"><i class="fab fa-twitter pr-1" aria-hidden=true></i></a>
<a href=//instagram.com/zhangxin_dawn/ target=_blank rel="noopener me"><i class="fab fa-instagram pr-1" aria-hidden=true></i></a>
<a href=mailto:xinzhang1215@gmail.com><i class="far fa-envelope-open pr-1" aria-hidden=true></i></a></div></div></div></div></div><main class=post-main-wrapper><div class=row><div class=col-md-10><div class="z-depth-1 post-wrapper white-bg single-post dont-break-out"><div class="post-header text-center"><ul class="post-meta li-x"><li><a href=https://zxdawn.github.io/categories/sci-tech><i class="fas fa-folder-open pr-1" aria-hidden=true></i> sci-tech</a></li></ul><div class="px-4 post-heading">Initializing the WRF model with ERA5</div><ul class="post-meta li-x mt-1"><li>Apr 20, 2018</li><li class=middot></li><li>9 minute read</li></ul><div class=view><img src=https://zxdawn.github.io/images/sci-tech/2017-12/ECMWF.png></div></div><div class="post-content markdown"><h2 id=note>Note</h2><p>This is the tutorial of using WRF with <strong>ERA5 model level</strong> (138 vertical levels) data.</p><p>If you prefer <strong>pressure level</strong> (38 vertical levels), please check another <a href=https://dreambooker.site/2019/10/03/Initializing-the-WRF-model-with-ERA5-pressure-level/>tutorial</a>.</p><p>I recommend the pressure level data, because the download speed is much faster.</p><p>If you don’t have cdsapi, please check this official <a href=https://cds.climate.copernicus.eu/api-how-to>tutorial</a>.</p><h2 id=summarization>Summarization</h2><ol><li>Download</li><li>Preprocess</li><li>Automation</li><li>Geogrid</li><li>Ungrib</li><li>Produce additional intermediate files</li><li>Metgrid</li></ol><h2 id=download>Download</h2><p>ERA5 data were downloaded as described in <a href=https://confluence.ecmwf.int/display/CKB/How+to+download+ERA5>How to download ERA5</a>.
Here I’m attaching scripts to download surface and model data:</p><p>if you want to use analysis and three-hour resolution, all you need to change are <code>data</code>, <code>area</code> and <code>target</code>. Otherwise, you should change as needed.</p><p>This is a little different from downloading ERA-Interim data. ERA-Interim includes Geopotential and Land-sea mask in invariant field. ERA5 includes them in surface dataset. So, we just need to download surface data and model level data.</p><h3 id=surface-data-getera5-sfcpy>Surface data (GetERA5-sfc.py)</h3><pre tabindex=0><code>import cdsapi
c = cdsapi.Client()
c.retrieve(&#39;reanalysis-era5-complete&#39;,{
    &#39;class&#39;:&#39;ea&#39;,
    &#39;date&#39;:&#39;DATE1/to/DATE2&#39;,
    &#39;area&#39;:&#39;Nort/West/Sout/East&#39;,
    &#39;expver&#39;:&#39;1&#39;,
    &#39;levtype&#39;:&#39;sfc&#39;,
   &#39;param&#39;:&#39;msl/sp/skt/2t/10u/10v/2d/z/lsm/sst/ci/sd/stl1/stl2/stl3/stl4/swvl1/swvl2/swvl3/swvl4&#39;, 
    &#39;stream&#39;:&#39;oper&#39;,
    &#39;time&#39;:&#39;00:00:00/03:00:00/06:00:00/09:00:00/12:00:00/15:00:00/18:00:00/21:00:00&#39;,
    &#39;type&#39;:&#39;an&#39;,
    &#39;grid&#39;:&#34;0.25/0.25&#34;,
},&#39;ERA5-DATE1-DATE2-sfc.grb&#39;)
</code></pre><h3 id=model-level-data-getera5-mlpy>Model level data (GetERA5-ml.py)</h3><pre tabindex=0><code>import cdsapi
c = cdsapi.Client()
c.retrieve(&#39;reanalysis-era5-complete&#39;,{
    &#39;class&#39;:&#39;ea&#39;,
    &#39;date&#39;:&#39;DATE1/to/DATE2&#39;,
    &#39;area&#39;:&#39;Nort/West/Sout/East&#39;,
    &#39;expver&#39;:&#39;1&#39;,
    &#39;levelist&#39;: &#39;1/to/137&#39;,
    &#39;levtype&#39;:&#39;ml&#39;,
    &#39;param&#39;:&#39;129/130/131/132/133/152&#39;,
    &#39;stream&#39;:&#39;oper&#39;,
    &#39;time&#39;:&#39;00:00:00/03:00:00/06:00:00/09:00:00/12:00:00/15:00:00/18:00:00/21:00:00&#39;,
    &#39;type&#39;:&#39;an&#39;,
    &#39;grid&#39;:&#34;0.25/0.25&#34;,
},&#39;ERA5-DATE1-DATE2-ml.grb&#39;)
</code></pre><h2 id=preprocess>Preprocess</h2><h3 id=install--eccodes-recommended-or-grib_api>Install eccodes (recommended) or grib_api</h3><p>Install <a href=https://software.ecmwf.int/wiki/display/ECC/ecCodes+Home>eccodes</a> or <a href=https://software.ecmwf.int/wiki/display/GRIB/Home>grib_api</a> according to ECMWF.</p><p>If you choose grib_api, you must install the new version of grib_api. Otherwise, you will get this error when using grib_set (e.g. grib_api Version 1.12.3):</p><pre tabindex=0><code>GRIB_API ERROR   :  Key &#34;numberOfVerticalCoordinateValues&#34;: Trying to encode value of 276 but the maximum allowable value is 255 (number of bits=8)

GRIB_API ERROR   :  unable to set NV=276 as long (Encoding invalid)
GRIB_API ERROR   :  grib_set_values[0] deletePV (1) failed: Key/value not found
GRIB_API ERROR   :  grib_set_values[1] edition (1) failed: Encoding invalid
</code></pre><h3 id=preprocess-surface-data-optional>Preprocess surface data (optional)</h3><pre tabindex=0><code>echo &#39;write &#34;[centre]_[dataDate]_[dataType]_[levelType]_[step].grib[edition]&#34;;&#39; &gt; split.rule  
grib_filter split.rule your/surface_data/name
</code></pre><h3 id=preprocess-model-level-data-necessary>Preprocess model level data (necessary)</h3><pre tabindex=0><code>grib_set -s deletePV=1,edition=1 your/model_level_data/name your/model_level_data/name.grib1
grib_filter split.rule your/model_level_data/name.grib1
</code></pre><p>Finally, you will get these files (the structure of filename is <code>[centre]_[dataDate]_[dataType]_[levelType]_[step].grib[edition]</code>):</p><p>|&ndash; ecmf_20150531_an_ml_0.grib1
|&ndash; ecmf_20150531_an_sfc_0.grib1
|&ndash; ecmf_20150601_an_ml_0.grib1
|&ndash; ecmf_20150601_an_sfc_0.grib1</p><p>Link_grib.csh all these files in your preprocessing working directory.</p><h2 id=automation-script-download--preprocess>Automation script (Download + Preprocess)</h2><p>You can automate the script rather than change elements one by one (as suggested by <a href=http://conorsweeneyucd.blogspot.com/2015/01/download-era-interim-data.html>Conor</a>).</p><pre tabindex=0><code>#!/bin/bash -l

CODEDIR=/nuist/u/home/yinyan/xin/scratch/data/ERA5/code
DATADIR=/nuist/u/home/yinyan/xin/scratch/data/ERA5/data

# Set your python environment
export PATH=~/xin/work/anaconda3/bin:$PATH
source activate root
cd $CODEDIR

DATE1=20170419
DATE2=20170420
Nort=90
West=0
Sout=-30
East=180
YY1=`echo $DATE1 | cut -c1-4`
MM1=`echo $DATE1 | cut -c5-6`
DD1=`echo $DATE1 | cut -c7-8`
YY2=`echo $DATE2 | cut -c1-4`
MM2=`echo $DATE2 | cut -c5-6`
DD2=`echo $DATE2 | cut -c7-8`

sed -e &#34;s/DATE1/${DATE1}/g;s/DATE2/${DATE2}/g;s/Nort/${Nort}/g;s/West/${West}/g;s/Sout/${Sout}/g;s/East/${East}/g;&#34; GetERA5-sfc.py &gt; GetERA5-${DATE1}-${DATE2}-sfc.py

python GetERA5-${DATE1}-${DATE2}-sfc.py

sed -e &#34;s/DATE1/${DATE1}/g;s/DATE2/${DATE2}/g;s/Nort/${Nort}/g;s/West/${West}/g;s/Sout/${Sout}/g;s/East/${East}/g;&#34; GetERA5-ml.py &gt; GetERA5-${DATE1}-${DATE2}-ml.py

python GetERA5-${DATE1}-${DATE2}-ml.py

mkdir -p ${DATADIR}/$YY1

mv ERA5-${DATE1}-${DATE2}-sfc.grb ERA5-${DATE1}-${DATE2}-ml.grb ${DATADIR}/$YY1/

cd ${DATADIR}/$YY1/

echo &#39;write &#34;[centre]_[dataDate]_[dataType]_[levelType]_[step].grib[edition]&#34;;&#39; &gt; split.rule
grib_filter split.rule ERA5-${DATE1}-${DATE2}-sfc.grb
grib_set -s deletePV=1,edition=1 ERA5-${DATE1}-${DATE2}-ml.grb ERA5-${DATE1}-${DATE2}-ml.grib1
grib_filter split.rule ERA5-${DATE1}-${DATE2}-ml.grib1

# If you want to delete original files, you can uncomment the following line.
# rm *grb

exit 0
</code></pre><h2 id=geogrid>Geogrid</h2><p>run geogrid.exe as usual</p><h2 id=ungrib>Ungrib</h2><p>run ungrib.exe by using the following Vtable (as suggested by <a href="https://valcap74.blogspot.com/2017/10/how-to-run-wrf-model-driven-by-era5-on.html?showComment=1524140953190#c5741939636532233503">valerio</a>):</p><pre tabindex=0><code>GRIB | Level| Level| Level| metgrid | metgrid | metgrid                 |
Code | Code |  1 |  2 | Name   | Units  | Description               |
-----+------+------+------+----------+----------+------------------------------------------+  
 130 | 109 |  * |   | TT    | K    | Temperature               |
 131 | 109 |  * |   | UU    | m s-1  | U                    |
 132 | 109 |  * |   | VV    | m s-1  | V                    |
 133 | 109 |  * |   | SPECHUMD | kg kg-1 | Specific humidity            |
 152 | 109 |  * |   | LOGSFP  | Pa    | Log surface pressure           |
 157 | 109 |  * |   | RHUM   | %    | Relative humidity            |
 129 | 1  |  0 |   | SOILGEO | m2 s-2    |                     |
   | 1  |  0 |   | SOILHGT | m    | Terrain field of source analysis     |   
 165 | 1  |  0 |   | UU    | m s-1  | U                    | At 10 m   
 166 | 1  |  0 |   | VV    | m s-1  | V                    | At 10 m   
 167 | 1  |  0 |   | TT    | K    | Temperature               | At 2 m   
 168 | 1  |  0 |   | DEWPT  | K    |                     | At 2 m   
   | 1  |  0 |   | RH    | %    | Relative Humidity at 2 m         | At 2 m   
 172 | 1  |  0 |   | LANDSEA | 0/1 Flag | Land/Sea flag              |
 134 | 1  |  0 |   | PSFC   | Pa    | Surface Pressure             |
 134 | 109 |  1 |   | PSFCH  | Pa    |                     |
 151 | 1  |  0 |   | PMSL   | Pa    | Sea-level Pressure            |
 235 | 1  |  0 |   | SKINTEMP | K    | Sea-Surface Temperature         |
 31 | 1  |  0 |   | SEAICE  | 0/1 Flag | Sea-Ice-Flag               |
 34 | 1  |  0 |   | SST   | K    | Sea-Surface Temperature         |
 141 | 1  |  0 |   | SNOW_EC | m    |                     |
   | 1  |  0 |   | SNOW   | kg m-2  |Water Equivalent of Accumulated Snow Depth|  
 139 | 112 |  0 |  7 | ST000007 | K    | T of 0-7 cm ground layer         |
 170 | 112 |  7 | 28 | ST007028 | K    | T of 7-28 cm ground layer        |
 183 | 112 | 28 | 100 | ST028100 | K    | T of 28-100 cm ground layer       |
 236 | 112 | 100 | 255 | ST100255 | K    | T of 100-255 cm ground layer       |
 39 | 112 |  0 |  7 | SM000007 | fraction | Soil moisture of 0-7 cm ground layer   |   
 40 | 112 |  7 | 28 | SM007028 | fraction | Soil moisture of 7-28 cm ground layer  |   
 41 | 112 | 28 | 100 | SM028100 | fraction | Soil moisture of 28-100 cm ground layer |   
 42 | 112 | 100 | 255 | SM100255 | fraction | Soil moisture of 100-255 cm ground layer |   
-----+------+------+------+----------+----------+------------------------------------------+
</code></pre><h2 id=produce-additional-intermediate-files>Produce additional intermediate files</h2><p>Create the following ecmwf_coeffs table (named ecmwf_coeffs) and run */WPS/util/calc_ecmwf_p.exe:</p><pre tabindex=0><code>0 0.000000 0.00000000  
1 2.000365 0.00000000  
2 3.102241 0.00000000  
3 4.666084 0.00000000  
4 6.827977 0.00000000  
5 9.746966 0.00000000  
6 13.605424 0.00000000  
7 18.608931 0.00000000  
8 24.985718 0.00000000  
9 32.985710 0.00000000  
10 42.879242 0.00000000  
11 54.955463 0.00000000  
12 69.520576 0.00000000  
13 86.895882 0.00000000  
14 107.415741 0.00000000  
15 131.425507 0.00000000  
16 159.279404 0.00000000  
17 191.338562 0.00000000  
18 227.968948 0.00000000  
19 269.539581 0.00000000  
20 316.420746 0.00000000  
21 368.982361 0.00000000  
22 427.592499 0.00000000  
23 492.616028 0.00000000  
24 564.413452 0.00000000  
25 643.339905 0.00000000  
26 729.744141 0.00000000  
27 823.967834 0.00000000  
28 926.344910 0.00000000  
29 1037.201172 0.00000000  
30 1156.853638 0.00000000  
31 1285.610352 0.00000000  
32 1423.770142 0.00000000  
33 1571.622925 0.00000000  
34 1729.448975 0.00000000  
35 1897.519287 0.00000000  
36 2076.095947 0.00000000  
37 2265.431641 0.00000000  
38 2465.770508 0.00000000  
39 2677.348145 0.00000000  
40 2900.391357 0.00000000  
41 3135.119385 0.00000000  
42 3381.743652 0.00000000  
43 3640.468262 0.00000000  
44 3911.490479 0.00000000  
45 4194.930664 0.00000000  
46 4490.817383 0.00000000  
47 4799.149414 0.00000000  
48 5119.895020 0.00000000  
49 5452.990723 0.00000000  
50 5798.344727 0.00000000  
51 6156.074219 0.00000000  
52 6526.946777 0.00000000  
53 6911.870605 0.00000000  
54 7311.869141 0.00000000  
55 7727.412109 0.00000700  
56 8159.354004 0.00002400  
57 8608.525391 0.00005900  
58 9076.400391 0.00011200  
59 9562.682617 0.00019900  
60 10065.978516 0.00034000  
61 10584.631836 0.00056200  
62 11116.662109 0.00089000  
63 11660.067383 0.00135300  
64 12211.547852 0.00199200  
65 12766.873047 0.00285700  
66 13324.668945 0.00397100  
67 13881.331055 0.00537800  
68 14432.139648 0.00713300  
69 14975.615234 0.00926100  
70 15508.256836 0.01180600  
71 16026.115234 0.01481600  
72 16527.322266 0.01831800  
73 17008.789062 0.02235500  
74 17467.613281 0.02696400  
75 17901.621094 0.03217600  
76 18308.433594 0.03802600  
77 18685.718750 0.04454800  
78 19031.289062 0.05177300  
79 19343.511719 0.05972800  
80 19620.042969 0.06844800  
81 19859.390625 0.07795800  
82 20059.931641 0.08828600  
83 20219.664062 0.09946200  
84 20337.863281 0.11150500  
85 20412.308594 0.12444800  
86 20442.078125 0.13831300  
87 20425.718750 0.15312500  
88 20361.816406 0.16891000  
89 20249.511719 0.18568900  
90 20087.085938 0.20349100  
91 19874.025391 0.22233300  
92 19608.572266 0.24224400  
93 19290.226562 0.26324200  
94 18917.460938 0.28535400  
95 18489.707031 0.30859800  
96 18006.925781 0.33293900  
97 17471.839844 0.35825400  
98 16888.687500 0.38436300  
99 16262.046875 0.41112500  
100 15596.695312 0.43839100  
101 14898.453125 0.46600300  
102 14173.324219 0.49380000  
103 13427.769531 0.52161900  
104 12668.257812 0.54930100  
105 11901.339844 0.57669200  
106 11133.304688 0.60364800  
107 10370.175781 0.63003600  
108 9617.515625 0.65573600  
109 8880.453125 0.68064300  
110 8163.375000 0.70466900  
111 7470.343750 0.72773900  
112 6804.421875 0.74979700  
113 6168.531250 0.77079800  
114 5564.382812 0.79071700  
115 4993.796875 0.80953600  
116 4457.375000 0.82725600  
117 3955.960938 0.84388100  
118 3489.234375 0.85943200  
119 3057.265625 0.87392900  
120 2659.140625 0.88740800  
121 2294.242188 0.89990000  
122 1961.500000 0.91144800  
123 1659.476562 0.92209600  
124 1387.546875 0.93188100  
125 1143.250000 0.94086000  
126 926.507812 0.94906400  
127 734.992188 0.95655000  
128 568.062500 0.96335200  
129 424.414062 0.96951300  
130 302.476562 0.97507800  
131 202.484375 0.98007200  
132 122.101562 0.98454200  
133 62.781250 0.98850000  
134 22.835938 0.99198400  
135 3.757813 0.99500300  
136 0.000000 0.99763000  
137 0.000000 1.00000000
</code></pre><h2 id=metgrid>Metgrid</h2><p>Edit namelist.wps like this:</p><pre tabindex=0><code>&amp;ungrib
out_format = &#39;WPS&#39;,
prefix = &#39;FILE&#39;,
/

&amp;metgrid
fg_name = &#39;FILE&#39;,&#39;PRES&#39;
io_form_metgrid = 2,
</code></pre><p>If you just run metgrid.exe, you&rsquo;ll get these warnings:</p><pre tabindex=0><code>WARNING: Entry in METGRID.TBL not found for field ST100255. Default options will be used for this field!
WARNING: Entry in METGRID.TBL not found for field SM100255. Default options will be used for this field!
WARNING: Entry in METGRID.TBL not found for field LOGSFP. Default options will be used for this field!
</code></pre><p>You can edit METGRID.TBL to set interpolation method of <code>ST100255</code> <code>SM100255</code> and <code>LOGSFP</code>:</p><pre tabindex=0><code>========================================
name=ST
        z_dim_name=num_st_layers
        derived=yes
        ....
# ELSE IF
        fill_lev =   7 : ST000007(200100)
        fill_lev =  28 : ST007028(200100)
        fill_lev = 100 : ST028100(200100)
        fill_lev = 255 : ST100255(200100)
        ....
========================================
name=SM
        z_dim_name=num_sm_layers
        derived=yes
        ....
# ELSE IF
        fill_lev =   7 : SM000007(200100)
        fill_lev =  28 : SM007028(200100)
        fill_lev = 100 : SM028100(200100)
        fill_lev = 255 : SM100255(200100)
        ....
....
....
========================================
name=SM100255
        interp_option=sixteen_pt+four_pt+wt_average_4pt+wt_average_16pt+search
        masked=water
        interp_mask=LANDSEA(0)
        missing_value=-1.E30
        fill_missing=1.
        flag_in_output=FLAG_SM100255
========================================
....
....
========================================
name=ST100255
        interp_option=sixteen_pt+four_pt+wt_average_4pt+wt_average_16pt+search
        masked=water
        interp_mask=LANDSEA(0)
        missing_value=-1.E30
        fill_missing=285.
        flag_in_output=FLAG_ST100255
========================================
....
....
========================================
name=LOGSFP
        interp_option=four_pt+average_4pt
        fill_lev=200100:PSFC(200100.)
        flag_in_output=FLAG_LOGSFP
========================================
</code></pre><p>Run metgrid.exe with the modified METGRID.TBL.ARW table.</p><h2 id=note-of-mozbc>Note of mozbc</h2><p><del>If you&rsquo;re using MOZART in WRF-Chem, then you need to change LOGSFP field in met* files to PSFC:</del></p><pre tabindex=0><code>$ for i in met*; do ncap2 -s &#39;PSFC=exp(LOGSFP)&#39; &#34;$i&#34; &#34;$i&#34;_tmp; done
After checking tmp files:
$ rename nc_tmp nc *.nc_tmp
</code></pre><p>You should use surface pressure directly from surface level for MOZART in WRF-Chem.</p><h2 id=references>References</h2><ol><li><a href="https://valcap74.blogspot.com/2017/10/how-to-run-wrf-model-driven-by-era5-on.html?showComment=1524140953190#c5741939636532233503">How to run the WRF model using ERA5 (on model levels) as initial and boundary conditions</a></li><li><a href=https://software.ecmwf.int/wiki/display/OIFSUF/Grib+to+Netcdf+conversion>Grib to Netcdf conversion</a></li><li><a href=http://conorsweeneyucd.blogspot.com/2015/01/download-era-interim-data.html>Download ERA-Interim data</a></li></ol><h2 id=version-control>Version control</h2><table><thead><tr><th>Version</th><th>Action</th><th>Time</th></tr></thead><tbody><tr><td>1.0</td><td>Init</td><td>2018-04-20</td></tr><tr><td>1.1</td><td>ERA5 are accessed via the Climate Data Store (CDS) infrastructure. Update download scripts.</td><td>2019-04-16</td></tr><tr><td>1.2</td><td>Update Vtable</td><td>2019-08-22</td></tr><tr><td>1.3</td><td>Add note of pressure level</td><td>2019-10-03</td></tr></tbody></table></div><div class=row><div class=col-md-8><div class=mb-5><div class="li-x div-x post-meta"><li class=pr-0><a href=https://zxdawn.github.io/tags/><i class="fas fa-tags"></i></a></li><div class=tags-sm><li><a href=https://zxdawn.github.io/tags/era5 role=button>ERA5</a></li><li><a href=https://zxdawn.github.io/tags/wrf-chem role=button>WRF-Chem</a></li></div></div></div></div></div><div class="row pt-3"><div class=col-md-6><a href=https://zxdawn.github.io/2018/03/11/behr_omino2-guide-for-non_berkeley/ class=post-meta>Previous<div class="pt-2 pb-5 d-flex"><i class="fas fa-angle-left text-grey font-weight-bold mr-2 active-color"></i>
<span>BEHR_OMINO2 Guide for non_Berkeley</span></div></a></div><div class="col-md-6 text-right"><a href=https://zxdawn.github.io/2018/04/29/ssh%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/ class=post-meta>Next<div class="pt-2 pb-5 flex-reverse"><i class="fas fa-angle-right text-grey font-weight-bold ml-2 active-color"></i>
<span>ssh内网穿透</span></div></a></div></div><section id=comments><hr><div id=comment-form><h3 id=comment-form-header>Say something</h3><form method=post action=https://ta1tk27bs2.execute-api.us-east-2.amazonaws.com/prod/v2/entry/zxdawn/zxdawn.github.io/main/comments><input type=hidden name=options[redirect] value=https://zxdawn.github.io/2018/04/20/initializing-the-wrf-model-with-era5/#comment-submitted>
<input type=hidden name=options[redirectError] value=https://zxdawn.github.io/2018/04/20/initializing-the-wrf-model-with-era5/#comment-error>
<input type=hidden name=options[slug] value=Initializing-the-WRF-model-with-ERA5>
<input type=hidden name=options[section] value=sci-tech>
<input type=hidden name=options[origin] value=https://zxdawn.github.io/2018/04/20/initializing-the-wrf-model-with-era5/>
<input type=hidden name=options[parent] value=Initializing-the-WRF-model-with-ERA5>
<input type=hidden name=fields[reply_to]>
<input type=address name=fields[botpot] placeholder="botpot (do not fill!)" style=display:none><fieldset><input name=fields[name] type=text placeholder="Your name"></fieldset><fieldset><input name=fields[email] type=email placeholder="Your email address"></fieldset><fieldset><textarea name=fields[body] placeholder="You can use Markdown syntax" rows=10></textarea></fieldset><fieldset><div class=notify-me><input type=checkbox id=comment-form-reply name=options[subscribe] value=email>
<label for=comment-form-reply>Send me an email when someone comments on this post.</label></div></fieldset><fieldset><input type=submit value=Submit id=submit-button class=right>
<input type=reset value=Reset class=right></fieldset></form></div><div id=comment-submitted class=dialog><h3>Thank you</h3><p>Your comment has been submitted and will be published once it has been approved.</p></div><div id=comment-error class=dialog><h3>OOPS!</h3><p>Your comment has not been submitted. Please <a href=https://zxdawn.github.io/2018/04/20/initializing-the-wrf-model-with-era5/>go back</a> and try again. Thank You!</p><p>If this error persists, please open an issue by <a href=https://github.com/zxdawn/zxdawn.github.io/issues>clicking here</a>.</p></div><h3>Comments (41)</h3><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/0fde6ee10beca32d43d4c22df8d9bf12?s=70"></figure><p class=comment-info><strong>Huidong Li</strong><br><small>Thursday, Apr 23, 2020</small></p></header><div id=4a748900-855f-11ea-af8c-e5820b998296 class=comment-thread><blockquote class=comment>Hi, I see the script download the data with the time option like time&rsquo;:&lsquo;00:00:00/03:00:00/06:00:00/09:00:00/12:00:00/15:00:00/18:00:00/21:00:00&rsquo;,
why the script download the data every 3hours? The resolution of ERA5 is hourly? Yes?</blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to Huidong Li</i><br>Friday, Apr 24, 2020</small></p></header><div class=comment>Sorry for the misleading. You can use <code>'time':'00/to/23/by/1',</code> to get the hourly data.</div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("4a748900-855f-11ea-af8c-e5820b998296","Huidong Li")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/feaf7e80999e11b41ba0eb37c5179605?s=70"></figure><p class=comment-info><strong>Soklin</strong><br><small>Monday, Apr 27, 2020</small></p></header><div id=ceb42690-889c-11ea-9c6e-8122a77374ad class=comment-thread><blockquote class=comment><p>Hi! I am so new to WRF and I want to run it with ERA5. I created a bash file for &ldquo;Automatic download&rdquo; as shown above. When I ran ./file_name.bash, I got the following error:
./GetERA5.bash: line 8: activate: No such file or directory
Traceback (most recent call last):
File &ldquo;GetERA5-20180101-20180102-sfc.py&rdquo;, line 1, in
import cdsapi
ImportError: No module named cdsapi
Traceback (most recent call last):
File &ldquo;GetERA5-20180101-20180102-ml.py&rdquo;, line 1, in
import cdsapi
ImportError: No module named cdsapi
mv: cannot stat &lsquo;ERA5-20180101-20180102-sfc.grb&rsquo;: No such file or directory
mv: cannot stat &lsquo;ERA5-20180101-20180102-ml.grb&rsquo;: No such file or directory
ERA5-20180101-20180102-sfc.grb: No such file or directory
ERA5-20180101-20180102-ml.grb: No such file or directory
ERA5-20180101-20180102-ml.grib1: No such file or directory</p><p>What could be the solution?</p></blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to Soklin</i><br>Tuesday, Apr 28, 2020</small></p></header><div class=comment><p>Hi Soklin,</p><p>You need to install <code>cdsapi</code> first. Please check the <a href=https://cds.climate.copernicus.eu/api-how-to>official tutorial</a>.</p><p>If you still have problems, please let me know.</p><p>Xin</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("ceb42690-889c-11ea-9c6e-8122a77374ad","Soklin")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/0bae4c608713a1832dfdf8edbd25e2c4?s=70"></figure><p class=comment-info><strong>Kiran P V</strong><br><small>Thursday, May 28, 2020</small></p></header><div id=65d64390-a09a-11ea-9761-cd5b7f12042b class=comment-thread><blockquote class=comment>Hi,
I successfully initialised the simulation with 137 levels.
But, In my study, I need only 27 metgrid levels. (1000,975,950,925,900,850,800,750,700,650,600,550,500,450,400,350,300,250,200,150,100,70,50,30,20,10hPA). What modification shoud be done for geting only these metgrid levels.</blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to Kiran P V</i><br>Thursday, May 28, 2020</small></p></header><div class=comment><p>Hi Kiran,</p><p>Why do you need 27 metgrid levels?</p><p>If you decide to use met_em* files to run WRF, WRF will interpolate data to the levels you set in the namelist (<code>eta_levels</code>) for you automatically.</p><p>Regards,
Xin</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("65d64390-a09a-11ea-9761-cd5b7f12042b","Kiran P V")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/bb9401ef7512edaf3beb2f30ab03dc3c?s=70"></figure><p class=comment-info><strong>Victor</strong><br><small>Saturday, Jun 6, 2020</small></p></header><div id=8af4d400-a812-11ea-b157-813291e5e125 class=comment-thread><blockquote class=comment>hello, i,m trying to run METGRID on WPS and it keep giving me this error
<em>ERROR: Could not open file METGRID.TBL</em>
kindly help me out</blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to Victor</i><br>Friday, Jun 12, 2020</small></p></header><div class=comment><p>Hi Victor,</p><p>Please make sure you compile the WPS successfully and the <code>METGRID.TBL</code> exists.</p><p>Xin</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("8af4d400-a812-11ea-b157-813291e5e125","Victor")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8c52f85cecf875dd7c36799afcc0e1dc?s=70"></figure><p class=comment-info><strong>Lee</strong><br><small>Friday, Jun 12, 2020</small></p></header><div id=158ce640-ac53-11ea-8b0d-eb4f639fffeb class=comment-thread><blockquote class=comment><p>Hi,
Thank you so much for your information.
I downloaded ERA5 in the above step and executed WPS.
The ungrib proceeded successfully, but an error occurred in metgrid.</p><p>ERROR: In read_next_field(), got error code -3.</p><p>In the metgrid process, I could not find an answer to the above error.
Can you give me a solution or advice?</p><p>(Below is the error message after ./metgrid.)
libi40iw-i40iw_vmapped_qp: failed to pin memory for SQ
libi40iw-i40iw_ucreate_qp: failed to map QP
libi40iw-i40iw_vmapped_qp: failed to pin memory for SQ
libi40iw-i40iw_ucreate_qp: failed to map QP
Processing domain 1 of 1
ERROR: In read_next_field(), got error code -3.
Abort(38406864) on node 0 (rank 0 in comm 0): application called MPI_Abort(MPI_COMM_WORLD, 38406864)-process 0</p></blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to Lee</i><br>Friday, Jun 12, 2020</small></p></header><div class=comment><p>Hi Lee,</p><p>I&rsquo;ve not met this error before. But, according to the error message, it should be related to the <strong>memory error</strong>.</p><p>Could you try larger memory? For example, more nodes with same cores when running <code>metgrid</code>.</p><p>Xin</p></div></article><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/24468c5deb27af5f217775d6527618f0?s=70"></figure><p class=comment-info><strong>Zhang Murez</strong><br><i><small>In reply to Lee</i><br>Saturday, Apr 24, 2021</small></p></header><div class=comment>This may related to permission issues.
<code>LD_LIBRARY_PATH=/home/****/usr/local//lib/ </code>which mpirun<code> /home/***/WRF_ISC21/practice/WRF_practice_kit/wrf.exe</code></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("158ce640-ac53-11ea-8b0d-eb4f639fffeb","Lee")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/d2eb3c2a6842c91d66d6b91740798503?s=70"></figure><p class=comment-info><strong>Peter A.</strong><br><small>Wednesday, Jul 29, 2020</small></p></header><div id=dd94ee00-d1cc-11ea-a214-6b5076d82fe6 class=comment-thread><blockquote class=comment>Hi Xin, thank you very much for your explanation. Everything was perfect up to ungrib with ERA5 surface and model levels. My ungrib was generating PFILES but was never able to generate all the corresponding FILES. Some strange error messages appeared in the log file (&ldquo;unknown out_format, ifv = 1133007385&rdquo; or &ldquo;Unrecognized map%igrid: 39936 in RRPR 2&rdquo; or &ldquo;Read error 1 in PARSE_TABLE&rdquo;). I then assumed a memory issue as the number of generated FILES or PFILES was not always the same. I increased node memory up to 125GB ! Then I obtained successful completion. Every FILE or PFILE has around 100MB size so the situation does not seem to be a logical one. I am using 137 levels 0.25 deg x 0.25 deg in an area of 35 deg x 70 deg for 32 times every hour. My command is srun -N1 -n8 &ndash;mpi=pmi2 &ndash;mem=125G /home/peter/Build_WRF/WPS-4.2/ungrib.exe Do you have a common sense explanation for the need of 125 GB?</blockquote><div class=comment-reply-button><input id=dd94ee00-d1cc-11ea-a214-6b5076d82fe6 type=button class=right value="Reply to Peter A." onclick='replyTo("dd94ee00-d1cc-11ea-a214-6b5076d82fe6","Peter A.")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/fe1ebf9ed20a33f87e91fbcdc6b1c304?s=70"></figure><p class=comment-info><strong>Ray</strong><br><small>Tuesday, Sep 8, 2020</small></p></header><div id=86ec91c0-f1ca-11ea-a117-4914f65d6c87 class=comment-thread><blockquote class=comment><p>Two comments:</p><p>(2) Not sure that you should have</p><p>fg_name = &lsquo;FILE&rsquo;,&lsquo;PRES&rsquo;</p><p>in the namelist.
calc_ecmwf_p.exe will open &lsquo;FILE&rsquo; and &lsquo;PRES&rsquo; to read the ERA5 data in these files (produced by ungrib); if the files don&rsquo;t exist they are skipped. The calc_ecmwf_p.exe then WRITES a file &lsquo;PRES&rsquo; (with time/date appended after the colon); this is hardcoded in the program and represents the output of the .exe. I suggest that you should ONLY have</p><p>fg_name = &lsquo;FILE&rsquo;,</p><p>to avoid overwriting of the &lsquo;PRES&rsquo; output file, or (as I found in the situation with multiple dates in the input file) you may get a &lsquo;PRES&rsquo; file with only pressures but no HGT or RH; in the latter case metgrid.exe rescued the situation by silently interpolating the missing data but this not what you want (less accurate &mldr;). You should check the &lsquo;PRES&rsquo; output files to confirm you have pressure, height and RH - e.g. using WPS/util/plotfmt.ncl</p><p>Note that you DO need fg_name = &lsquo;FILE&rsquo;,&lsquo;PRES&rsquo; in the namelist when running metgrid.exe - it expects to read &lsquo;PRES&rsquo; (and any other such file e.g. a &lsquo;SURF&rsquo; file, if you have one).</p><p>(2) WRF rarely needs 137 levels. For example if PTOT=50hPa then model levels 45-137 are quite sufficient. It saves extracting a lot of data. You just need to amend the list of A,B values and reorder the level numbers in the GRIB.</p></blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to Ray</i><br>Tuesday, Sep 8, 2020</small></p></header><div class=comment><p>Thanks for the two comments, Ray.</p><p>I can&rsquo;t understand the method of extracting data;</p><blockquote><p>You just need to amend the list of A, B values, and reorder the level numbers in the GRIB.</p></blockquote><p>Could you give an example?</p><p>Regards,</p><p>Xin</p></div></article><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/fe1ebf9ed20a33f87e91fbcdc6b1c304?s=70"></figure><p class=comment-info><strong>Ray</strong><br><i><small>In reply to Ray</i><br>Thursday, Sep 10, 2020</small></p></header><div class=comment><p>Hi Xin,</p><p>Re using reduced number f model levels, see script below (amend to suit: FILEIN and LEVEL_MIN. Run this on the raw model level data file (not the surface data file). It handles the conversion to GRIB1 and PV issue. Note that if you extract only ml from (say) 45-137 you still need to extract the orography and LogPs at ml=1 i.e. amend your retrieval. You also need a new list of A,B values. Easiest way to get this is simply run, assuming you use ml starting from 45,
tail -n +45 List_A_B_Values.wrf.full | cut -d" " -f2- | nl -v0 | sed &rsquo;s/^ *//&rsquo; >List_A_B_Values.wrf.new</p><p>No changes are required fro the surface (non ml) data, apart from GRIB1 conversion etc.</p><p>Run the script to get processed ml data:</p><p>#!/bin/sh</p><h1 id=heading></h1><p>FILEIN=dummy.grb # the input file - the raw ml (GRIB2) ERA5 data from archive
[ -s &ldquo;$FILEIN&rdquo; ] || { echo &ldquo;** $FILEIN does not exist or size zero .. &ldquo;; exit 1; }</p><p>LEVEL_MIN=45 # i.e. we have retrieved levels 45-137 to save space</p><p>[ $LEVEL_MIN -le 1 ] && { echo &ldquo;** ml starting at 1?? - nothing to do!&rdquo;; exit 0; }</p><p>cat >filter_levels &#171;eof
write &ldquo;$$<em>[indicatorOfParameter]</em>[levelType]_[level]&rdquo;;
eof</p><h1 id=transform-to-grib1-and-fix-issue-with-pv>Transform to GRIB1 and fix issue with PV</h1><p>grib_set -r -s packingType=grid_simple $FILEIN $$.grb ||<br>{ echo &ldquo;** grib_set packing failed &mldr;&rdquo;; rm -f $$.grb; exit 1; }
grib_set -s deletePV=1,edition=1 $$.grb ${FILEIN}.$$ ||<br>{ echo &ldquo;** grib_set pv failed &mldr;&rdquo;; rm -f ${FILEIN}.$$; exit 1; }
rm -f $$.grb
FILE=${FILEIN}.$$</p><h1 id=split-file-into-single-grib-files>Split file into single GRIB files</h1><p>trap &lsquo;/bin/rm -f $$<em>*</em><em>_</em> filter_levels&rsquo; 0 1 2 3 6 15</p><p>grib_filter filter_levels &ldquo;$FILE&rdquo; ||<br>{ echo &ldquo;** grib_filter failed &mldr;&rdquo;; exit 1; }
rm -f $FILE</p><h1 id=sanity-check>Sanity check</h1><p>[ -s &ldquo;$$_t_ml_1&rdquo; ] &&<br>{ echo &ldquo;** It looks like your file has model levels from 1 .. nothing to do!&rdquo;; exit 0; }</p><h1 id=reset-model-levels-to-start-at-1-but-leave-sfcheightsfcgeopotentiallogps-alone>reset model levels to start at 1 (but leave sfcheight/sfcgeopotential/logPs alone)</h1><p>LEVEL_MIN=$((LEVEL_MIN - 1))</p><p>for file in $$<em>*</em><em>_</em>
do
LEVEL=${file##*_}
if [ &ldquo;$LEVEL&rdquo; -ne 1 ]
then
LEVEL_NEW=$((LEVEL - LEVEL_MIN))
#echo $LEVEL $LEVEL_NEW $file</p><p>grib_set -r -s level=$LEVEL_NEW $file ${file}.$$ ||<br>{ echo &ldquo;** grib_set failed &mldr;&rdquo;; rm -f ${file}.$$; exit 1; }
mv ${file}.$$ $file
fi
done</p><h1 id=merge-files-note-that-wrf-expects-files-ordered-by-datetime>Merge files (note that WRF expects files ordered by date/time)</h1><p>rm -f ${FILEIN}.reset_ml
grib_copy -B&rsquo;dataTime:i asc&rsquo; $$<em>*</em><em>_</em> ${FILEIN}.reset_ml ||<br>{ echo &ldquo;** failed to merge files &mldr;&rdquo;; rm -f ${FILEIN}.reset_ml; exit 1; }
echo &ldquo;** Adjusted file: ${FILEIN}.reset_ml&rdquo;
exit</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("86ec91c0-f1ca-11ea-a117-4914f65d6c87","Ray")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/de1d66040ea8c3d030f74ae37c4c1b11?s=70"></figure><p class=comment-info><strong>Divyansh</strong><br><small>Wednesday, Oct 28, 2020</small></p></header><div id=9ad20e10-1969-11eb-8798-811954e27bba class=comment-thread><blockquote class=comment><p>Hi Xin,</p><p>Do you think it would be better to edit METGRID.TBL to set interpolation method of ST100255 SM100255 and LOGSFP before or after running calc_ecmwf?</p></blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to Divyansh</i><br>Thursday, Oct 29, 2020</small></p></header><div class=comment><p>Hi Divyansh,</p><p>It&rsquo;s better to do that before running <code>calc_ecmwf</code>. The process shown in the blog is the complete step that records all my attempts.</p><p>Xin</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("9ad20e10-1969-11eb-8798-811954e27bba","Divyansh")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/de1d66040ea8c3d030f74ae37c4c1b11?s=70"></figure><p class=comment-info><strong>Divyansh</strong><br><small>Thursday, Oct 29, 2020</small></p></header><div id=0f3ac730-19fe-11eb-b62b-3f315ab7bbf8 class=comment-thread><blockquote class=comment><p>Hi Xin,</p><p>I was able to download all data for Dec 2015, use your Vtable and METGRID.TBL recommendations to successfully get the met_em files. On first look, the files looks alright. I compared them to some met_em files from a previous WRF run.</p><p>However, when I try to run WRF Real, the compiler immediately gives me an error. Something like this-
forrtl: severe (64): input conversion error, unit -5, file Internal Formatted Read</p><p>I know this is out of scope for this blogpost, but I was wondering if you had any thoughts. I can email you if you don&rsquo;t want to discuss it here. I would really appreciate any help.</p><p>Thanks
Div</p></blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to Divyansh</i><br>Monday, Nov 2, 2020</small></p></header><div class=comment><p>Hi, Divyansh,</p><p>I&rsquo;ve not met this error before. Maybe, you can increase the <code>debug_level</code> to 100 to see where this error happened exactly.</p><p>Regards,
Xin</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("0f3ac730-19fe-11eb-b62b-3f315ab7bbf8","Divyansh")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/d06c92ddfa4eccd96214d093018b8fea?s=70"></figure><p class=comment-info><strong>razy</strong><br><small>Sunday, Dec 6, 2020</small></p></header><div id=494f6e80-37db-11eb-abfa-1f7339372041 class=comment-thread><blockquote class=comment><p>Hi! first, thank you very much for the explanation.</p><p>i am having troubles downloading the data on model levels.
can you please have a quick check on it?</p><p>this is my try for the upper layer:</p><p>import cdsapi
c = cdsapi.Client()
c.retrieve(&lsquo;reanalysis-era5-complete&rsquo;,{
&lsquo;class&rsquo;:&rsquo;ea&rsquo;,
&lsquo;date&rsquo;:&lsquo;20191024/to/20191027&rsquo;,
&lsquo;area&rsquo;:&lsquo;60/0/0/60&rsquo;,
&rsquo;expver&rsquo;:&lsquo;1&rsquo;,
&rsquo;levelist&rsquo;: &lsquo;1/to/137&rsquo;,
&rsquo;levtype&rsquo;:&lsquo;ml&rsquo;,
&lsquo;param&rsquo;:&lsquo;129/130/131/132/133/152&rsquo;,
&lsquo;stream&rsquo;:&lsquo;oper&rsquo;,
&rsquo;time&rsquo;:&lsquo;00:00:00/03:00:00/06:00:00/09:00:00/12:00:00/15:00:00/18:00:00/21:00:00&rsquo;,
&rsquo;type&rsquo;:&lsquo;an&rsquo;,
&lsquo;grid&rsquo;:&ldquo;0.25/0.25&rdquo;,
},&lsquo;ERA5-20191024-20191027-ml.grb&rsquo;)</p></blockquote><div class=comment-reply-button><input id=494f6e80-37db-11eb-abfa-1f7339372041 type=button class=right value="Reply to razy" onclick='replyTo("494f6e80-37db-11eb-abfa-1f7339372041","razy")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/cea7cea58cbdf5d28017430c99569584?s=70"></figure><p class=comment-info><strong>Luiz Filipe</strong><br><small>Sunday, Dec 20, 2020</small></p></header><div id=13ce6710-42e5-11eb-beca-e75c45c1648c class=comment-thread><blockquote class=comment><p>Hi Xin Zhang,</p><p>When I run the metgrid step I have that message in metgrid.log:</p><p>2020-12-20 16:51:30.240 &mdash; INFORM: GHT at level 200100.000000 already exists; leaving it alone.
2020-12-20 16:51:30.240 &mdash; INFORM: PRESSURE at level 200100.000000 already exists; leaving it alone.
2020-12-20 16:51:30.240 &mdash; ERROR: For fill_lev specification, level in source field must be an integer, enclosed in parentheses immediately after the fieldname</p><p>Could you help me with solution ?</p></blockquote><div class=comment-reply-button><input id=13ce6710-42e5-11eb-beca-e75c45c1648c type=button class=right value="Reply to Luiz Filipe" onclick='replyTo("13ce6710-42e5-11eb-beca-e75c45c1648c","Luiz Filipe")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/c9e1dd99e7c207e1934e66acfdd0e287?s=70"></figure><p class=comment-info><strong>S.M. Quamrul Hassan</strong><br><small>Saturday, Jan 2, 2021</small></p></header><div id=7c6a5ae0-4d1c-11eb-be16-67c3142c1ba1 class=comment-thread><blockquote class=comment><p>After changing METGRID.TBL I am getting error
./metgrid.exe
Processing domain 1 of 1
Processing 2017-04-19_00
ERA5
PRES
ERROR: For fill_lev specification, level in source field must be an integer, enclosed in parentheses immediately after the fieldname
Note: The following floating-point exceptions are signalling: IEEE_OVERFLOW_FLAG</p><p>Solution please</p></blockquote><div class=comment-reply-button><input id=7c6a5ae0-4d1c-11eb-be16-67c3142c1ba1 type=button class=right value="Reply to S.M. Quamrul Hassan" onclick='replyTo("7c6a5ae0-4d1c-11eb-be16-67c3142c1ba1","S.M. Quamrul Hassan")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/7ba6d3b65f9bb5be270e9f4657de4940?s=70"></figure><p class=comment-info><strong>dou yj</strong><br><small>Saturday, Feb 13, 2021</small></p></header><div id=8652b5a0-6df3-11eb-aa8f-91236d5031fc class=comment-thread><blockquote class=comment><p>i used the above method you provided, i have finished WPS and real.exe, but when i run wrf.exe, there is only one time step wrfout result output, the rest was stopped as shown below:</p><p>WRF NUMBER OF TILES = 1<br>Timing for main: time 2020-01-01_00:00:06 on domain 4: 9.17834 elapsed seconds
Timing for main: time 2020-01-01_00:00:13 on domain 4: 0.26596 elapsed seconds
Timing for main: time 2020-01-01_00:00:20 on domain 4: 0.26474 elapsed seconds
Timing for main: time 2020-01-01_00:00:20 on domain 3: 31.61249 elapsed seconds
Timing for main: time 2020-01-01_00:00:26 on domain 4: 0.22471 elapsed seconds
Timing for main: time 2020-01-01_00:00:33 on domain 4: 0.22481 elapsed seconds
Timing for main: time 2020-01-01_00:00:40 on domain 4: 0.21778 elapsed seconds
Timing for main: time 2020-01-01_00:00:40 on domain 3: 0.88264 elapsed seconds
Timing for main: time 2020-01-01_00:00:46 on domain 4: 0.24162 elapsed seconds
Timing for main: time 2020-01-01_00:00:53 on domain 4: 0.25533 elapsed seconds
Timing for main: time 2020-01-01_00:01:00 on domain 4: 0.25462 elapsed seconds
Timing for main: time 2020-01-01_00:01:00 on domain 3: 1.02395 elapsed seconds
Timing for main: time 2020-01-01_00:01:00 on domain 2: 42.03529 elapsed seconds
Timing for main: time 2020-01-01_00:01:06 on domain 4: 0.22090 elapsed seconds
Timing for main: time 2020-01-01_00:01:13 on domain 4: 0.23874 elapsed seconds
Timing for main: time 2020-01-01_00:01:20 on domain 4: 0.20617 elapsed seconds
Timing for main: time 2020-01-01_00:01:20 on domain 3: 0.91364 elapsed seconds
Timing for main: time 2020-01-01_00:01:26 on domain 4: 0.23009 elapsed seconds
Timing for main: time 2020-01-01_00:01:33 on domain 4: 0.20038 elapsed seconds
forrtl: error (78): process killed (SIGTERM)
Image PC Routine Line Source<br>wrf.exe 0000000003658611 Unknown Unknown Unknown
wrf.exe 0000000003656D67 Unknown Unknown Unknown
libnetcdff.so.6 00002B4CB1FD0BC2 Unknown Unknown Unknown
libnetcdff.so.6 00002B4CB1FD0A16 Unknown Unknown Unknown
libnetcdff.so.6 00002B4CB1FB75BC Unknown Unknown Unknown
libnetcdff.so.6 00002B4CB1FBB5F3 Unknown Unknown Unknown
libpthread.so.0 000000398DC0F710 Unknown Unknown Unknown
wrf.exe 000000000334C295 Unknown Unknown Unknown</p><p>the above info was wield for me, i cannot find the reason for continuing run, have you met this kind of errors?
thanks</p></blockquote><div class=comment-reply-button><input id=8652b5a0-6df3-11eb-aa8f-91236d5031fc type=button class=right value="Reply to dou yj" onclick='replyTo("8652b5a0-6df3-11eb-aa8f-91236d5031fc","dou yj")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/7ba6d3b65f9bb5be270e9f4657de4940?s=70"></figure><p class=comment-info><strong>dou yj</strong><br><small>Monday, Feb 15, 2021</small></p></header><div id=cef4f440-6f87-11eb-bde5-a1ea6639f828 class=comment-thread><blockquote class=comment>hi, why the above Vtable doesn&rsquo;t include GHT variable? it&rsquo;s strange</blockquote><div class=comment-reply-button><input id=cef4f440-6f87-11eb-bde5-a1ea6639f828 type=button class=right value="Reply to dou yj" onclick='replyTo("cef4f440-6f87-11eb-bde5-a1ea6639f828","dou yj")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/52a99350d5fa686ab2baa84c712f5fbc?s=70"></figure><p class=comment-info><strong>Matt</strong><br><small>Thursday, Mar 11, 2021</small></p></header><div id=29837d40-8280-11eb-9aee-cfc1ee084bbd class=comment-thread><blockquote class=comment><p>Hello,</p><p>After running WPS (with no errors), I&rsquo;m running real.exe and encounter this error:</p><h2 id=gridtsk-unreasonable>&mdash;&mdash;&mdash;&mdash;&ndash; FATAL CALLED &mdash;&mdash;&mdash;&mdash;&mdash;
FATAL CALLED FROM FILE: LINE: 2977
grid%tsk unreasonable</h2><p>I&rsquo;m using WRF/WPS v4.1.3. I&rsquo;ve looked into the SKINTEMP variable and did not find any unreasonable values associated with it. In my metgrid output files, I appear to not have a TSK variable at all. I&rsquo;ve tried several fixes such as editing the METGRID.TBL file to change how to fill missing values, etc. How should I go about solving this?</p></blockquote><div class=comment-reply-button><input id=29837d40-8280-11eb-9aee-cfc1ee084bbd type=button class=right value="Reply to Matt" onclick='replyTo("29837d40-8280-11eb-9aee-cfc1ee084bbd","Matt")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/e6e5c7c2ec268a653a2d86a7eb2b3a09?s=70"></figure><p class=comment-info><strong>Vinod Kumar</strong><br><small>Thursday, Apr 1, 2021</small></p></header><div id=411ef070-92d8-11eb-8db4-b1a89621c582 class=comment-thread><blockquote class=comment><p>Hi,
Thanks a lot for the tutorial. I was wondering, why do we need the parameters 129 (Geopotential) and 152 (logarithm of Surface pressure) at model levels. As far as I understand, these are available on single levels only.</p><p>Best regards,
Vinod</p></blockquote><div class=comment-reply-button><input id=411ef070-92d8-11eb-8db4-b1a89621c582 type=button class=right value="Reply to Vinod Kumar" onclick='replyTo("411ef070-92d8-11eb-8db4-b1a89621c582","Vinod Kumar")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/6a46f744e47957aa37561980fc8a4c29?s=70"></figure><p class=comment-info><strong>Jores TAGUEMFO</strong><br><small>Friday, Apr 30, 2021</small></p></header><div id=04450f50-a998-11eb-ac93-d59a2aeb5420 class=comment-thread><blockquote class=comment><p>Hi all
Please i run WRF with ERA5 data and i respect the following steps that you give us below. But in step that you recommend to create ecmwf_coeffs file with coeffs below, i don&rsquo;t the directory that you recommend to save this file.</p><p>Please can you help me ?</p></blockquote><div class=comment-reply-button><input id=04450f50-a998-11eb-ac93-d59a2aeb5420 type=button class=right value="Reply to Jores TAGUEMFO" onclick='replyTo("04450f50-a998-11eb-ac93-d59a2aeb5420","Jores TAGUEMFO")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/?s=70"></figure><p class=comment-info><strong>Andreas Hilboll</strong><br><small>Thursday, Dec 6, 2018</small></p></header><div id=98efd4f4-030f-494a-b880-e0c5f387bc3d class=comment-thread><blockquote class=comment><p>Hi, thanks for this writeup!</p><p>Can you please elaborate why you need to create PSFC in the last step?</p><p>My met_em files already contain a PSFC field (I download it as field"134" or &ldquo;sp&rdquo; from ECMWF).</p><p>Interestingly, the original PSFC values I download are significantly different from what I get by re-creating PSFC from LOGSFP as you do it.</p><p>Can you shed some light on this issue? I&rsquo; really appreciate!</p></blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to Andreas Hilboll</i><br>Thursday, Dec 6, 2018</small></p></header><div class=comment><p>Thank you for your report!</p><ol><li><p>Because surf_press_name is <code>PSFC</code> in <code>mo_wrfchem_lib.f90</code> file which is needed by MOZART mechanism. If you just use WRF, you don&rsquo;t have to convert it.</p></li><li><p>For the problem of difference, it looks strange!</p></li></ol><p>Could you send the figure (which compare both variables) or the file just containing these variable (you can use ncks to extract it)?</p><p>My email address: <a href=mailto:xinzhang1215@gmail.com>xinzhang1215@gmail.com</a>.</p></div></article><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/?s=70"></figure><p class=comment-info><strong>Andreas Hilboll</strong><br><i><small>In reply to Andreas Hilboll</i><br>Monday, Dec 10, 2018</small></p></header><div class=comment><p>just talked to ECMWF Service Desk, here&rsquo;s their answer:</p><p>It is more complex than doing <code>exp(lnsp) -> sp</code>. As a general rule, you should use lnsp if you work with the model level data. Otherwise you should get surface pressure directly from surface level.</p><p>So it seems you did the correct thing.</p></div></article><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to Andreas Hilboll</i><br>Monday, Dec 10, 2018</small></p></header><div class=comment><p>Thank you for your reply!</p><p>As you said, I should use surface pressure directly from surface level for MOZART in WRF-Chem.</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("98efd4f4-030f-494a-b880-e0c5f387bc3d","Andreas Hilboll")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/?s=70"></figure><p class=comment-info><strong>omid</strong><br><small>Thursday, Dec 6, 2018</small></p></header><div id=149f4eac-3820-49dd-b6fe-cd04dc7be2ba class=comment-thread><blockquote class=comment><p>Hi, Thanks for sharing.</p><p>As @Andreas Hilboll said, I want to take surface pressure directly from ERA5.</p><p>So I added the parameter code 134.128 to GetERA5-sfc.py. Both ungrib.exe and calc_ecmwf_p.exe work fine. But metgrid.exe fails saying <code>ERROR: Error in ext_pkg_write_field</code>.</p><p>Can you please let me know how to add surface pressure to grib files.</p></blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to omid</i><br>Thursday, Dec 6, 2018</small></p></header><div class=comment><p>Actually, you can add these lines: ========================================</p><h1 id=typically-from-ecmwf-model-level-data-and-used-by-calc_ecmwf_pexe>Typically from ECMWF model-level data and used by calc_ecmwf_p.exe</h1><h1 id=not-needed-by-wrf>Not needed by WRF</h1><p>name=LOGSFP
output=no
interp_option=four_pt
======================================== This is the link of issue mentioned on GitHub: <a href=https://github.com/wrf-model/WPS/issues/115>https://github.com/wrf-model/WPS/issues/115</a></p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("149f4eac-3820-49dd-b6fe-cd04dc7be2ba","omid")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/?s=70"></figure><p class=comment-info><strong>lacstorm</strong><br><small>Friday, Jun 14, 2019</small></p></header><div id=7d69c671-089a-47e3-ab9d-e76bf3979c14 class=comment-thread><blockquote class=comment><p>Hi, thanks for sharing.</p><p>When I download the model level data, the requests always failed after a long time (say 80 hours) of queue.</p><p>While it&rsquo;s ok when i download pressure level data or sfc data.</p><p>Is there any possibility that you know the reason?</p><p>Besides if I use the pressure level data, I should follow the same steps as you mentioned before or i need to do something else?</p><p>Hope for you reply.</p></blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to lacstorm</i><br>Friday, Jun 14, 2019</small></p></header><div class=comment><p>I don&rsquo;t know the exact reason. You can contact someone on the official website :)</p><p>For pressure level data, here&rsquo;s the related link: <a href="http://forum.wrfforum.com/viewtopic.php?f=22&t=10966">http://forum.wrfforum.com/viewtopic.php?f=22&t=10966</a></p><p>It seems that there&rsquo;re some issues when the pressure level data are used. Anyway, you can try it by yourself :)</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("7d69c671-089a-47e3-ab9d-e76bf3979c14","lacstorm")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/?s=70"></figure><p class=comment-info><strong>NO NICKNAME</strong><br><small>Wednesday, Jun 19, 2019</small></p></header><div id=46267831-93ef-4baf-b1b7-0949cac933b4 class=comment-thread><blockquote class=comment><p>Hi, sorry to bother again.</p><p>I use WPS V3.8.1 to handle the ml-data.</p><p>It&rsquo;s all ok before the last step metgrid.exe.</p><p>I got the error message:</p><p>Once I add</p><p>.</p></blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to NO NICKNAME</i><br>Wednesday, Jun 19, 2019</small></p></header><div class=comment><p>That&rsquo;s usually related to the loss of surface level data.</p><p>I can&rsquo;t reproduce the error as yours.</p><p>Please check your data (<strong>both level and sfc</strong>) again.</p></div></article><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/?s=70"></figure><p class=comment-info><strong>NO NICKNAME</strong><br><i><small>In reply to NO NICKNAME</i><br>Wednesday, Jun 19, 2019</small></p></header><div class=comment><p>Do you mean there is something wrong with the ERA5 data I download?</p><p>By the way I use the exact auto_process script from this page.</p></div></article><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to NO NICKNAME</i><br>Wednesday, Jun 19, 2019</small></p></header><div class=comment><p>Actually, you can add these lines:</p><p>5</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("46267831-93ef-4baf-b1b7-0949cac933b4","NO NICKNAME")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/?s=70"></figure><p class=comment-info><strong>Peter</strong><br><small>Thursday, Jul 18, 2019</small></p></header><div id=35e0a330-be73-434d-8fa5-fa692b833d1a class=comment-thread><blockquote class=comment><p>Hi,</p><p>I&rsquo;ve successfully used these instructions when the download was from the ECMWF API, but now that the data is on Copernicus, the Copernicus API will only give me the model-level data in GRIB2 format.</p><p>This causes an error when running ungrib, as the Vtable you&rsquo;ve given is only for GRIB1 format.</p><p>Anyone else having this issue? Is it an easy modification for the Vtable?</p></blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/de1d66040ea8c3d030f74ae37c4c1b11?s=70"></figure><p class=comment-info><strong>Divyansh</strong><br><i><small>In reply to Peter</i><br>Wednesday, Oct 28, 2020</small></p></header><div class=comment><p>Hi Peter,
Did you preprocess the model level data as mentioned by Xin?</p><p>grib_set -s deletePV=1,edition=1 your/model_level_data/name your/model_level_data/name.grib1
grib_filter split.rule your/model_level_data/name.grib1</p><p>Divyansh</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("35e0a330-be73-434d-8fa5-fa692b833d1a","Peter")'></div><div style=clear:both></div></div></article></section></div></div><div class="col-md-2 pl-0"><div id=page-scrollspy class=toc-nav><ul class="nav nav-pills ml-0"><li class="nav-item pb-3 text-center"><span class="font-weight-bold mb-2">- CATALOG -</span></li><ul class=nav><li class=nav-item><a class=nav-link href=#note>Note</a></li></ul><ul class=nav><li class=nav-item><a class=nav-link href=#summarization>Summarization</a></li></ul><ul class=nav><li class=nav-item><a class=nav-link href=#download>Download</a></li></ul><ul class=nav><ul class=nav><li class=nav-item><a class=nav-link href=#surface-data-getera5-sfcpy>Surface data (GetERA5-sfc.py)</a></li></ul></ul><ul class=nav><ul class=nav><li class=nav-item><a class=nav-link href=#model-level-data-getera5-mlpy>Model level data (GetERA5-ml.py)</a></li></ul></ul><ul class=nav><li class=nav-item><a class=nav-link href=#preprocess>Preprocess</a></li></ul><ul class=nav><ul class=nav><li class=nav-item><a class=nav-link href=#install--eccodes-recommended-or-grib_api>Install eccodes (recommended) or grib_api</a></li></ul></ul><ul class=nav><ul class=nav><li class=nav-item><a class=nav-link href=#preprocess-surface-data-optional>Preprocess surface data (optional)</a></li></ul></ul><ul class=nav><ul class=nav><li class=nav-item><a class=nav-link href=#preprocess-model-level-data-necessary>Preprocess model level data (necessary)</a></li></ul></ul><ul class=nav><li class=nav-item><a class=nav-link href=#automation-script-download--preprocess>Automation script (Download + Preprocess)</a></li></ul><ul class=nav><li class=nav-item><a class=nav-link href=#geogrid>Geogrid</a></li></ul><ul class=nav><li class=nav-item><a class=nav-link href=#ungrib>Ungrib</a></li></ul><ul class=nav><li class=nav-item><a class=nav-link href=#produce-additional-intermediate-files>Produce additional intermediate files</a></li></ul><ul class=nav><li class=nav-item><a class=nav-link href=#metgrid>Metgrid</a></li></ul><ul class=nav><li class=nav-item><a class=nav-link href=#note-of-mozbc>Note of mozbc</a></li></ul><ul class=nav><li class=nav-item><a class=nav-link href=#references>References</a></li></ul><ul class=nav><li class=nav-item><a class=nav-link href=#version-control>Version control</a></li></ul></ul></div></div></div></main><script src=https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js></script>
<script>addBackToTop({diameter:56,backgroundColor:"rgb(255, 82, 82)",textColor:"#fff"})</script><footer class="page-footer text-center font-small mt-4 wow fadeIn"><div class="pb-2 mt-5 pt-5"><a href=//github.com/zxdawn target=_blank rel="noopener me"><i class="fab fa-github pr-1" aria-hidden=true></i></a>
<a href=//twitter.com/zhangxin_dawn target=_blank rel="noopener me"><i class="fab fa-twitter pr-1" aria-hidden=true></i></a>
<a href=//instagram.com/zhangxin_dawn/ target=_blank rel="noopener me"><i class="fab fa-instagram pr-1" aria-hidden=true></i></a>
<a href=mailto:xinzhang1215@gmail.com><i class="far fa-envelope-open pr-1" aria-hidden=true></i></a></div><div class="copyright py-4"><span>2016 - 2022 &copy; | Theme <a href=https://github.com/EliiseS/AllinOne target=_blank>AllinOne</a></span></div></footer><script type=text/javascript src=https://zxdawn.github.io/js/vendors/jquery/jquery-3.3.1.min.js></script>
<script type=text/javascript src=https://zxdawn.github.io/js/vendors/jquery/jquery.smooth-scroll.min.js></script>
<script type=text/javascript src=https://zxdawn.github.io/js/vendors/popper.min.js></script>
<script type=text/javascript src=https://zxdawn.github.io/js/vendors/holder.min.js></script>
<script type=text/javascript src=https://zxdawn.github.io/js/vendors-extensions/bootstrap4/bootstrap.min.js></script>
<script type=text/javascript src=https://zxdawn.github.io/js/vendors/mdb/mdb.min.js></script>
<script type=text/javascript src=https://zxdawn.github.io/js/main.js></script>
<script src=https://zxdawn.github.io/js/vendors/highlight.pack.js></script><script>hljs.initHighlightingOnLoad()</script><script type=text/javascript>(new WOW).init()</script><script src=https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js></script>
<script>addBackToTop({diameter:56,backgroundColor:"rgb(255, 82, 82)",textColor:"#fff"})</script></body></html>