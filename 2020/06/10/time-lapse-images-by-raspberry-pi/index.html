<!doctype html><html lang=zn-hans><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no,maximum-scale=1"><meta name=author content="Xin Zhang"><meta name=description content="Time-lapse images using two usb cameras and one Raspberry Pi"><meta property="og:title" content="Time-lapse images by Raspberry Pi"><meta property="og:description" content="Time-lapse images using two usb cameras and one Raspberry Pi"><meta property="og:type" content="article"><meta property="og:url" content="https://zxdawn.github.io/2020/06/10/time-lapse-images-by-raspberry-pi/"><meta property="article:section" content="sci-tech"><meta property="article:published_time" content="2020-06-10T00:00:00+00:00"><meta property="article:modified_time" content="2020-06-10T00:00:00+00:00"><title>Time-lapse images by Raspberry Pi | Dreambooker</title><link rel=canonical href=https://zxdawn.github.io/2020/06/10/time-lapse-images-by-raspberry-pi/><link href=https://zxdawn.github.io/vendors/fontawesome-free-5.14.0-web/css/all.min.css rel=stylesheet><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Ubuntu+Mono:400,400i,700,700i|Raleway:300,400,500,600"><link href=https://zxdawn.github.io/css/font.css rel=stylesheet><link href=https://zxdawn.github.io/css/vendors/bootstrap4/bootstrap.min.css rel=stylesheet><link href=https://zxdawn.github.io/css/vendors-extensions/mdb/mdb.min.css rel=stylesheet><link href=https://zxdawn.github.io/css/vendors/mdb/style.min.css rel=stylesheet><link href=https://zxdawn.github.io/css/main.css rel=stylesheet><link rel="shortcut icon" href=https://zxdawn.github.io/img/logo.jpg><style type=text/css>@media(min-width:800px) and (max-width:850px){.navbar:not(.top-nav-collapse){background:#1c2331!important}}</style><link rel=stylesheet href=https://zxdawn.github.io/css/vendors/highlight/github-gist.css></head><body class=bg-light data-spy=scroll data-target=#page-scrollspy data-offset=90><nav class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class=container><a class=navbar-brand href=https://zxdawn.github.io><img class=avatar src=https://zxdawn.github.io/img/logo.jpg style=width:40px!important;height:auto class="d-inline-block align-top" alt>
<strong>Xin Zhang</strong></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=https://zxdawn.github.io>Home</a></li><li class=nav-item><a class=nav-link href=https://zxdawn.github.io/sci-tech/>Sci-Tech</a></li><li class=nav-item><a class=nav-link href=https://zxdawn.github.io/essay/>Essay</a></li><li class=nav-item><a class=nav-link href=https://zxdawn.github.io/about/>About</a></li></ul></div></div></nav><div id=site-header class="carousel slide carousel-fade" data-ride=carousel style=height:18rem><div class=carousel-inner role=listbox><div class="carousel-item active"><div class=view style=background-image:url(https://zxdawn.github.io/img/header-slides/0.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://zxdawn.github.io/img/header-slides//1.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://zxdawn.github.io/img/header-slides//2.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://zxdawn.github.io/img/header-slides//3.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://zxdawn.github.io/img/header-slides//4.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div></div><div class="carousel-content text-center white-text wow fadeIn"><div class="row mx-0 headfont mt-3 pt-4"><div class="col-12 col-sm-5 align-middle"><a href=https://zxdawn.github.io><img class="pull-right avatar avatar-md" src=https://zxdawn.github.io/img/me.jpg alt></a></div><div class="col-12 col-sm-7 text-left pl-2"><a href=https://zxdawn.github.io><h1 class="mb-2 h1" style=font-weight:300><strong>Dreambooker</strong></h1></a><div class=mt-2 style=font-size:1rem;color:#fff><a href=//github.com/zxdawn target=_blank rel="noopener me"><i class="fab fa-github pr-1" aria-hidden=true></i></a>
<a href=//twitter.com/zhangxin_dawn target=_blank rel="noopener me"><i class="fab fa-twitter pr-1" aria-hidden=true></i></a>
<a href=//instagram.com/zhangxin_dawn/ target=_blank rel="noopener me"><i class="fab fa-instagram pr-1" aria-hidden=true></i></a>
<a href=mailto:xinzhang1215@gmail.com><i class="far fa-envelope-open pr-1" aria-hidden=true></i></a></div></div></div></div></div><main class=post-main-wrapper><div class=row><div class=col-md-10><div class="z-depth-1 post-wrapper white-bg single-post dont-break-out"><div class="post-header text-center"><ul class="post-meta li-x"><li><a href=https://zxdawn.github.io/categories/sci-tech><i class="fas fa-folder-open pr-1" aria-hidden=true></i> sci-tech</a></li></ul><div class="px-4 post-heading">Time-lapse images by Raspberry Pi</div><ul class="post-meta li-x mt-1"><li>Jun 10, 2020</li><li class=middot></li><li>3 minute read</li></ul><div class=view><img src=https://zxdawn.github.io/images/sci-tech/2020-06/pi_logo.jpg></div></div><div class="post-content markdown"><h2 id=examples>Examples</h2><p><img src=https://zxdawn.github.io/images/sci-tech/2020-06/example.jpg alt=example></p><h2 id=set-up-raspberry-pi>Set up Raspberry Pi</h2><h3 id=install-system>Install system</h3><p>I used <a href=https://rufus.ie/>rufus</a> to write the <a href=https://www.raspberrypi.org/downloads/raspberry-pi-os/>official Raspberry Pi OS</a> to SD card.</p><p>If you bought the SD card with Raspberry Pi, they may have installed one system.</p><p>It&rsquo;s better to format it first and install the official one.</p><h3 id=initialize-ssh>Initialize SSH</h3><p>You need to create an empty file named <code>ssh</code> under the <code>boot</code> dir.</p><p>Then, you can connect your Raspberry Pi using some softwares, like MobaXterm and putty.</p><h3 id=connect-to-your-pi>Connect to your Pi</h3><p>Because I&rsquo;m using the school Internet, the simple method (Edit <code>wpa_supplicant.conf</code>) mentioned in many guides don&rsquo;t work.</p><p>I figured out that a laptop (connected to the school WIFI) and an Ethernet cable are enough.</p><ol><li><p>Connect the Pi to the laptop using cable</p></li><li><p>Share the network to the Ethernet</p><p><img src=https://zxdawn.github.io/images/sci-tech/2020-06/network_share.png alt=network></p></li><li><p>Check the IP by comparing the results of <code>arp -a</code></p><p><img src=https://zxdawn.github.io/images/sci-tech/2020-06/ip.png alt=IP></p></li></ol><h3 id=install-python>Install Python</h3><p>Since I wanna do lots of things on the Pi, I prefer installing my own Python through Miniconda.</p><p>Please check this <a href=https://stackoverflow.com/questions/39371772/how-to-install-anaconda-on-raspberry-pi-3-model-b>tutorial</a>.</p><h2 id=set-up-camera>Set up camera</h2><h3 id=enable-camera>Enable camera</h3><ol><li><code>sudo raspi-config</code></li><li>Set a new password</li><li>Set a hostname (mine is <code>maxdoas</code>)</li><li><code>Interfacing Options</code> &ndash;> <code>Camera</code> &ndash;> <code>Yes</code></li></ol><h3 id=install-camera-on-the-instrument>Install camera on the instrument</h3><p>I fixed two USB cameras with screws on a board which is on the top of my instrument called <strong>MAX-DOAS</strong>.</p><p><img src=https://zxdawn.github.io/images/sci-tech/2020-06/maxdoas.jpeg alt=maxdoas></p><h2 id=time-lapse-script>Time-lapse script</h2><ol><li><p>We can get the ports of cameras by checking the results of <code>ls /dev/video*</code> with cameras plugged in and not.</p><pre tabindex=0><code>pi@raspberrypi:~ $ ls /dev/video*
/dev/video0  /dev/video10  /dev/video12  /dev/video3
/dev/video1  /dev/video11  /dev/video2
</code></pre></li><li><p>I will use <code>/dev/video0</code> and <code>/dev/video2</code>.</p></li><li><p>Because I don&rsquo;t wanna install too much libraries on Pi, I chose <strong>fswebcam</strong> (<code>sudo apt-get install fswebcam</code>) to let the cameras capture images every 2 minutes:</p></li><li><p>The content of <code>tlapse.py</code>:</p><pre tabindex=0><code>import os
import time
import subprocess
from datetime import datetime

while True:
    # set ouput dir and filename
    lapse_dir = datetime.strftime(datetime.now(),&#34;/home/pi/timelapse/%Y/%m/%Y%m%d/&#34;)
    os.makedirs(lapse_dir, exist_ok=True)
    prefix = datetime.strftime(datetime.now(),&#34;%Y-%m-%d_%H-%M&#34;)
    filename = lapse_dir+&#34;/&#34;+prefix

    # take photos and save
    subprocess.call([&#39;fswebcam&#39;, &#39;-d&#39;, &#39;/dev/video0&#39;,
                     &#39;-r&#39;,&#39;1920x1080&#39;,
                     &#39;-S&#39;, &#39;20&#39;,
                     &#39;--rotate&#39;, &#39;180&#39;,
                     &#39;--no-banner&#39;,
                     filename+&#39;_1.jpg&#39;])
    #print(&#39;Saving photo to %s&#39;%(filename))
    time.sleep(0.5)

    subprocess.call([&#39;fswebcam&#39;, &#39;-d&#39;, &#39;/dev/video2&#39;,
                     &#39;-r&#39;,&#39;1920x1080&#39;,
                     &#39;-S&#39;, &#39;20&#39;,
                     &#39;--rotate&#39;, &#39;180&#39;,
                     &#39;--no-banner&#39;,
                     filename+&#39;_2.jpg&#39;])
    #print(&#39;Saving photo to %s&#39;%(filename))

    time.sleep(120)
</code></pre><p><code>-r</code>: resolution</p><p><code>-S</code>: skipping frames for auto focus</p><p><code>--rotate</code>: rotation</p><p><code>--no-banner</code>: without banner</p></li><li><p>Let us set it to take photos automatically when the Pi is started, especially for the power failure case.</p><p>Just add the Python path to the beginning of Python script <code>tlapse.py</code> and the script name to <code>/etc/rc.local</code>:</p><ol><li><code>tlapse.py</code></li></ol><p>You can check the path of Python by <code>which python</code></p><pre tabindex=0><code>#!/home/pi/miniconda3/bin/python
import os
........
</code></pre><ol start=2><li><code>/etc/rc.local</code></li></ol><pre tabindex=0><code>/home/pi/tlapse.py &amp;
</code></pre></li><li><p>Reboot and check the process by<code>pgrep tlapse*</code>.</p><p>If you wanna kill it, you can type <code>sudo pkill tlapse*</code>.</p></li></ol><h2 id=sync-images-to-server>Sync images to server</h2><p>As the SD card just has 64 G, I decide to sync the local images to the server by <code>rsync</code>.</p><p>This <a href=https://bencane.com/2014/01/07/using-rsync-to-synchronize-a-local-and-remote-directory/>tutorial</a> shows the detailed steps.</p><h2 id=references>References</h2><ol><li><a href=https://www.jeffgeerling.com/blog/2017/raspberry-pi-zero-w-headless-time-lapse-camera>Raspberry Pi Zero W as a headless time-lapse camera</a></li><li><a href=https://hub.packtpub.com/working-webcam-and-pi-camera/>Working with a Webcam and Pi Camera</a></li><li><a href=https://lonewolfonline.net/raspberry-pi-timelapse-videos/>Raspberry Pi Time-lapse Videos with USB Webcam</a></li><li><a href=https://bencane.com/2014/01/07/using-rsync-to-synchronize-a-local-and-remote-directory/>Using rsync to synchronize a local and remote directory</a></li></ol><h2 id=version-control>Version control</h2><table><thead><tr><th>Version</th><th>Action</th><th>Time</th></tr></thead><tbody><tr><td>1.0</td><td>Init</td><td>2020-06-11</td></tr><tr><td>1.1</td><td>Add skipping frames in script</td><td>2020-06-12</td></tr></tbody></table></div><div class=row><div class=col-md-8><div class=mb-5><div class="li-x div-x post-meta"><li class=pr-0><a href=https://zxdawn.github.io/tags/><i class="fas fa-tags"></i></a></li><div class=tags-sm><li><a href=https://zxdawn.github.io/tags/raspberry-pi role=button>raspberry-pi</a></li></div></div></div></div></div><div class="row pt-3"><div class=col-md-6><a href=https://zxdawn.github.io/2020/03/24/run-sublimetext-in-wsl/ class=post-meta>Previous<div class="pt-2 pb-5 d-flex"><i class="fas fa-angle-left text-grey font-weight-bold mr-2 active-color"></i>
<span>Run sublimetext in WSL</span></div></a></div><div class="col-md-6 text-right"><a href=https://zxdawn.github.io/2020/07/03/download-fengyun-data-in-one-script/ class=post-meta>Next<div class="pt-2 pb-5 flex-reverse"><i class="fas fa-angle-right text-grey font-weight-bold ml-2 active-color"></i>
<span>Download FENGYUN data in one script</span></div></a></div></div><section id=comments><hr><div id=comment-form><h3 id=comment-form-header>Say something</h3><form method=post action=https://ta1tk27bs2.execute-api.us-east-2.amazonaws.com/prod/v2/entry/github/zxdawn/zxdawn.github.io/main/comments><input type=hidden name=options[redirect] value=https://zxdawn.github.io/2020/06/10/time-lapse-images-by-raspberry-pi/#comment-submitted>
<input type=hidden name=options[redirectError] value=https://zxdawn.github.io/2020/06/10/time-lapse-images-by-raspberry-pi/#comment-error>
<input type=hidden name=options[slug] value=raspberry_pi>
<input type=hidden name=options[section] value=sci-tech>
<input type=hidden name=options[origin] value=https://zxdawn.github.io/2020/06/10/time-lapse-images-by-raspberry-pi/>
<input type=hidden name=options[parent] value=raspberry_pi>
<input type=hidden name=fields[reply_to]>
<input type=address name=fields[botpot] placeholder="botpot (do not fill!)" style=display:none><fieldset><input name=fields[name] type=text placeholder="Your name"></fieldset><fieldset><input name=fields[email] type=email placeholder="Your email address"></fieldset><fieldset><textarea name=fields[body] placeholder="You can use Markdown syntax" rows=10></textarea></fieldset><fieldset><div class=notify-me><input type=checkbox id=comment-form-reply name=options[subscribe] value=email>
<label for=comment-form-reply>Send me an email when someone comments on this post.</label></div></fieldset><fieldset><input type=submit value=Submit id=submit-button class=right>
<input type=reset value=Reset class=right></fieldset></form></div><div id=comment-submitted class=dialog><h3>Thank you</h3><p>Your comment has been submitted and will be published once it has been approved.</p></div><div id=comment-error class=dialog><h3>OOPS!</h3><p>Your comment has not been submitted. Please <a href=https://zxdawn.github.io/2020/06/10/time-lapse-images-by-raspberry-pi/>go back</a> and try again. Thank You!</p><p>If this error persists, please open an issue by <a href=https://github.com/zxdawn/zxdawn.github.io/issues>clicking here</a>.</p></div></section></div></div><div class="col-md-2 pl-0"><div id=page-scrollspy class=toc-nav><ul class="nav nav-pills ml-0"><li class="nav-item pb-3 text-center"><span class="font-weight-bold mb-2">- CATALOG -</span></li><ul class=nav><li class=nav-item><a class=nav-link href=#examples>Examples</a></li></ul><ul class=nav><li class=nav-item><a class=nav-link href=#set-up-raspberry-pi>Set up Raspberry Pi</a></li></ul><ul class=nav><ul class=nav><li class=nav-item><a class=nav-link href=#install-system>Install system</a></li></ul></ul><ul class=nav><ul class=nav><li class=nav-item><a class=nav-link href=#initialize-ssh>Initialize SSH</a></li></ul></ul><ul class=nav><ul class=nav><li class=nav-item><a class=nav-link href=#connect-to-your-pi>Connect to your Pi</a></li></ul></ul><ul class=nav><ul class=nav><li class=nav-item><a class=nav-link href=#install-python>Install Python</a></li></ul></ul><ul class=nav><li class=nav-item><a class=nav-link href=#set-up-camera>Set up camera</a></li></ul><ul class=nav><ul class=nav><li class=nav-item><a class=nav-link href=#enable-camera>Enable camera</a></li></ul></ul><ul class=nav><ul class=nav><li class=nav-item><a class=nav-link href=#install-camera-on-the-instrument>Install camera on the instrument</a></li></ul></ul><ul class=nav><li class=nav-item><a class=nav-link href=#time-lapse-script>Time-lapse script</a></li></ul><ul class=nav><li class=nav-item><a class=nav-link href=#sync-images-to-server>Sync images to server</a></li></ul><ul class=nav><li class=nav-item><a class=nav-link href=#references>References</a></li></ul><ul class=nav><li class=nav-item><a class=nav-link href=#version-control>Version control</a></li></ul></ul></div></div></div></main><script src=https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js></script>
<script>addBackToTop({diameter:56,backgroundColor:"rgb(255, 82, 82)",textColor:"#fff"})</script><footer class="page-footer text-center font-small mt-4 wow fadeIn"><div class="pb-2 mt-5 pt-5"><a href=//github.com/zxdawn target=_blank rel="noopener me"><i class="fab fa-github pr-1" aria-hidden=true></i></a>
<a href=//twitter.com/zhangxin_dawn target=_blank rel="noopener me"><i class="fab fa-twitter pr-1" aria-hidden=true></i></a>
<a href=//instagram.com/zhangxin_dawn/ target=_blank rel="noopener me"><i class="fab fa-instagram pr-1" aria-hidden=true></i></a>
<a href=mailto:xinzhang1215@gmail.com><i class="far fa-envelope-open pr-1" aria-hidden=true></i></a></div><div class="copyright py-4"><span>2016 - 2022 &copy; | Theme <a href=https://github.com/EliiseS/AllinOne target=_blank>AllinOne</a></span></div></footer><script type=text/javascript src=https://zxdawn.github.io/js/vendors/jquery/jquery-3.3.1.min.js></script>
<script type=text/javascript src=https://zxdawn.github.io/js/vendors/jquery/jquery.smooth-scroll.min.js></script>
<script type=text/javascript src=https://zxdawn.github.io/js/vendors/popper.min.js></script>
<script type=text/javascript src=https://zxdawn.github.io/js/vendors/holder.min.js></script>
<script type=text/javascript src=https://zxdawn.github.io/js/vendors-extensions/bootstrap4/bootstrap.min.js></script>
<script type=text/javascript src=https://zxdawn.github.io/js/vendors/mdb/mdb.min.js></script>
<script type=text/javascript src=https://zxdawn.github.io/js/main.js></script>
<script src=https://zxdawn.github.io/js/vendors/highlight.pack.js></script><script>hljs.initHighlightingOnLoad()</script><script type=text/javascript>(new WOW).init()</script><script src=https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js></script>
<script>addBackToTop({diameter:56,backgroundColor:"rgb(255, 82, 82)",textColor:"#fff"})</script></body></html>