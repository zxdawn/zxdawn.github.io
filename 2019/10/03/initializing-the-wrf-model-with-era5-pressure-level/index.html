<!doctype html><html lang=zn-hans><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no,maximum-scale=1"><meta name=author content="Xin Zhang"><meta name=description content="Downloading ERA5 pressure level data by Python and initialize WRF model"><meta property="og:title" content="Initializing the WRF model with ERA5 (pressure level)"><meta property="og:description" content="Downloading ERA5 pressure level data by Python and initialize WRF model"><meta property="og:type" content="article"><meta property="og:url" content="https://zxdawn.github.io/2019/10/03/initializing-the-wrf-model-with-era5-pressure-level/"><meta property="article:section" content="sci-tech"><meta property="article:published_time" content="2019-10-03T00:00:00+00:00"><meta property="article:modified_time" content="2019-10-03T00:00:00+00:00"><title>Initializing the WRF model with ERA5 (pressure level) | Dreambooker</title><link rel=canonical href=https://zxdawn.github.io/2019/10/03/initializing-the-wrf-model-with-era5-pressure-level/><link href=https://zxdawn.github.io/vendors/fontawesome-free-5.14.0-web/css/all.min.css rel=stylesheet><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Ubuntu+Mono:400,400i,700,700i|Raleway:300,400,500,600"><link href=https://zxdawn.github.io/css/font.css rel=stylesheet><link href=https://zxdawn.github.io/css/vendors/bootstrap4/bootstrap.min.css rel=stylesheet><link href=https://zxdawn.github.io/css/vendors-extensions/mdb/mdb.min.css rel=stylesheet><link href=https://zxdawn.github.io/css/vendors/mdb/style.min.css rel=stylesheet><link href=https://zxdawn.github.io/css/main.css rel=stylesheet><link rel="shortcut icon" href=https://zxdawn.github.io/img/logo.jpg><style type=text/css>@media(min-width:800px) and (max-width:850px){.navbar:not(.top-nav-collapse){background:#1c2331!important}}</style><link rel=stylesheet href=https://zxdawn.github.io/css/vendors/highlight/github-gist.css></head><body class=bg-light data-spy=scroll data-target=#page-scrollspy data-offset=90><nav class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class=container><a class=navbar-brand href=https://zxdawn.github.io><img class=avatar src=https://zxdawn.github.io/img/logo.jpg style=width:40px!important;height:auto class="d-inline-block align-top" alt>
<strong>Xin Zhang</strong></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=https://zxdawn.github.io>Home</a></li><li class=nav-item><a class=nav-link href=https://zxdawn.github.io/sci-tech/>Sci-Tech</a></li><li class=nav-item><a class=nav-link href=https://zxdawn.github.io/essay/>Essay</a></li><li class=nav-item><a class=nav-link href=https://zxdawn.github.io/about/>About</a></li></ul></div></div></nav><div id=site-header class="carousel slide carousel-fade" data-ride=carousel style=height:18rem><div class=carousel-inner role=listbox><div class="carousel-item active"><div class=view style=background-image:url(https://zxdawn.github.io/img/header-slides/0.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://zxdawn.github.io/img/header-slides//1.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://zxdawn.github.io/img/header-slides//2.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://zxdawn.github.io/img/header-slides//3.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://zxdawn.github.io/img/header-slides//4.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div></div><div class="carousel-content text-center white-text wow fadeIn"><div class="row mx-0 headfont mt-3 pt-4"><div class="col-12 col-sm-5 align-middle"><a href=https://zxdawn.github.io><img class="pull-right avatar avatar-md" src=https://zxdawn.github.io/img/me.jpg alt></a></div><div class="col-12 col-sm-7 text-left pl-2"><a href=https://zxdawn.github.io><h1 class="mb-2 h1" style=font-weight:300><strong>Dreambooker</strong></h1></a><div class=mt-2 style=font-size:1rem;color:#fff><a href=//github.com/zxdawn target=_blank rel="noopener me"><i class="fab fa-github pr-1" aria-hidden=true></i></a>
<a href=//twitter.com/zhangxin_dawn target=_blank rel="noopener me"><i class="fab fa-twitter pr-1" aria-hidden=true></i></a>
<a href=//instagram.com/zhangxin_dawn/ target=_blank rel="noopener me"><i class="fab fa-instagram pr-1" aria-hidden=true></i></a>
<a href=mailto:xinzhang1215@gmail.com><i class="far fa-envelope-open pr-1" aria-hidden=true></i></a></div></div></div></div></div><main class=post-main-wrapper><div class=row><div class=col-md-10><div class="z-depth-1 post-wrapper white-bg single-post dont-break-out"><div class="post-header text-center"><ul class="post-meta li-x"><li><a href=https://zxdawn.github.io/categories/sci-tech><i class="fas fa-folder-open pr-1" aria-hidden=true></i> sci-tech</a></li></ul><div class="px-4 post-heading">Initializing the WRF model with ERA5 (pressure level)</div><ul class="post-meta li-x mt-1"><li>Oct 3, 2019</li><li class=middot></li><li>2 minute read</li></ul><div class=view><img src=https://zxdawn.github.io/images/sci-tech/2017-12/ECMWF.png></div></div><div class="post-content markdown"><h2 id=note>Note</h2><p>This is the tutorial of using WRF with <strong>ERA5 pressure level</strong> (38 vertical levels) data.</p><p>If you prefer <strong>model level</strong> (138 vertical levels), please check another <a href=https://dreambooker.site/2018/04/20/Initializing-the-WRF-model-with-ERA5>tutorial</a>.</p><p>I recommend the pressure level data, because the download speed is much faster.</p><p>If you don&rsquo;t have cdsapi, please check this official <a href=https://cds.climate.copernicus.eu/api-how-to>tutorial</a>.</p><h2 id=required-fields>Required Fields</h2><blockquote><p>WRF requires a number of fields as input.</p><ul><li><p>3D Data (e.g. data on pressure levels)</p><ul><li>Temperature</li><li>U and V components of Wind</li><li>Geopotential Height</li><li>Relative Humidity
(<em>the code can calculate RH if Specific Humidity is available;this is controlled in the Vtable</em>)</li></ul></li><li><p>2D Data</p><ul><li>Surface Pressure</li><li>Mean Sea Level Pressure</li><li>Skin Temperature/SST</li><li>2-meter Temperature</li><li>2-meter Relative or Specific Humidity</li><li>10-meter U and V components of wind</li><li>Soil data (temperature and moisture) and soil height</li></ul></li></ul><p>If any masked field is ingested, then a <strong>LANDSEA</strong> field is recommended</p><p>Water equivalent snow depth (<strong>SNOW</strong>) is a nice field to have, but not required.</p><p><strong>SEAICE</strong> is good to have for a high latitude winter case, but it is not required.</p></blockquote><h3 id=single-level-data-getera5-slpy>Single level data (GetERA5-sl.py)</h3><pre tabindex=0><code>import cdsapi

c = cdsapi.Client()

c.retrieve(
    &#39;reanalysis-era5-single-levels&#39;,
    {
        &#39;product_type&#39;:&#39;reanalysis&#39;,
        &#39;format&#39;:&#39;grib&#39;,
        &#39;variable&#39;:[
            &#39;10m_u_component_of_wind&#39;,&#39;10m_v_component_of_wind&#39;,&#39;2m_dewpoint_temperature&#39;,
            &#39;2m_temperature&#39;,&#39;land_sea_mask&#39;,&#39;mean_sea_level_pressure&#39;,
            &#39;sea_ice_cover&#39;,&#39;sea_surface_temperature&#39;,&#39;skin_temperature&#39;,
            &#39;snow_depth&#39;,&#39;soil_temperature_level_1&#39;,&#39;soil_temperature_level_2&#39;,
            &#39;soil_temperature_level_3&#39;,&#39;soil_temperature_level_4&#39;,&#39;surface_pressure&#39;,
            &#39;volumetric_soil_water_layer_1&#39;,&#39;volumetric_soil_water_layer_2&#39;,&#39;volumetric_soil_water_layer_3&#39;,
            &#39;volumetric_soil_water_layer_4&#39;
        ],
        &#39;date&#39;:&#39;DATE1/DATE2&#39;,
        &#39;area&#39;:&#39;Nort/West/Sout/East&#39;,
        &#39;time&#39;:&#39;00/to/23/by/1&#39;,
    },
    &#39;ERA5-DATE1-DATE2-sl.grib&#39;)
</code></pre><h3 id=pressure-level-data-getera5-plpy>Pressure level data (GetERA5-pl.py)</h3><pre tabindex=0><code>import cdsapi

c = cdsapi.Client()

c.retrieve(
    &#39;reanalysis-era5-pressure-levels&#39;,
    {
        &#39;product_type&#39;:&#39;reanalysis&#39;,
        &#39;format&#39;:&#39;grib&#39;,
        &#39;pressure_level&#39;:[
            &#39;1&#39;,&#39;2&#39;,&#39;3&#39;,
            &#39;5&#39;,&#39;7&#39;,&#39;10&#39;,
            &#39;20&#39;,&#39;30&#39;,&#39;50&#39;,
            &#39;70&#39;,&#39;100&#39;,&#39;125&#39;,
            &#39;150&#39;,&#39;175&#39;,&#39;200&#39;,
            &#39;225&#39;,&#39;250&#39;,&#39;300&#39;,
            &#39;350&#39;,&#39;400&#39;,&#39;450&#39;,
            &#39;500&#39;,&#39;550&#39;,&#39;600&#39;,
            &#39;650&#39;,&#39;700&#39;,&#39;750&#39;,
            &#39;775&#39;,&#39;800&#39;,&#39;825&#39;,
            &#39;850&#39;,&#39;875&#39;,&#39;900&#39;,
            &#39;925&#39;,&#39;950&#39;,&#39;975&#39;,
            &#39;1000&#39;
        ],
        &#39;date&#39;:&#39;DATE1/DATE2&#39;,
        &#39;area&#39;:&#39;Nort/West/Sout/East&#39;,
        &#39;time&#39;:&#39;00/to/23/by/1&#39;,
        &#39;variable&#39;:[
            &#39;geopotential&#39;,&#39;relative_humidity&#39;,&#39;specific_humidity&#39;,
            &#39;temperature&#39;,&#39;u_component_of_wind&#39;,&#39;v_component_of_wind&#39;
        ]
    },
    &#39;ERA5-DATE1-DATE2-pl.grib&#39;)
</code></pre><h2 id=automation-script-download>Automation script (Download)</h2><p>You can automate the script rather than change elements one by one.</p><pre tabindex=0><code>#!/bin/bash -l

CODEDIR=/nuist/u/home/yinyan/xin/scratch/data/ERA5/code
DATADIR=/nuist/u/home/yinyan/xin/scratch/data/ERA5/data

# Set your python environment
export PATH=~/xin/work/anaconda3/bin:$PATH
source activate root
cd $CODEDIR

DATE1=20170419
DATE2=20170420
YY1=`echo $DATE1 | cut -c1-4`
MM1=`echo $DATE1 | cut -c5-6`
DD1=`echo $DATE1 | cut -c7-8`
YY2=`echo $DATE2 | cut -c1-4`
MM2=`echo $DATE2 | cut -c5-6`
DD2=`echo $DATE2 | cut -c7-8`
Nort=60
West=80
Sout=15
East=150

sed -e &#34;s/DATE1/${DATE1}/g;s/DATE2/${DATE2}/g;s/Nort/${Nort}/g;s/West/${West}/g;s/Sout/${Sout}/g;s/East/${East}/g;&#34; GetERA5-sl.py &gt; GetERA5-${DATE1}-${DATE2}-sl.py

python GetERA5-${DATE1}-${DATE2}-sl.py

sed -e &#34;s/DATE1/${DATE1}/g;s/DATE2/${DATE2}/g;s/Nort/${Nort}/g;s/West/${West}/g;s/Sout/${Sout}/g;s/East/${East}/g;&#34; GetERA5-pl.py &gt; GetERA5-${DATE1}-${DATE2}-pl.py

python GetERA5-${DATE1}-${DATE2}-pl.py

mkdir -p ${DATADIR}/$YY1

mv ERA5-${DATE1}-${DATE2}-sl.grib ERA5-${DATE1}-${DATE2}-pl.grib ${DATADIR}/$YY1/


exit 0
</code></pre><h2 id=geogrid>geogrid</h2><p>Run geogrid.exe as usual.</p><p>If you&rsquo;re not familiar with WRF, please check the <a href=http://www2.mmm.ucar.edu/wrf/OnLineTutorial/Basics/index.php>online tutorial</a> in detail.</p><h2 id=ungrib>ungrib</h2><p>Run ungrib.exe by using the <code>Vtable.ERA-interim.pl</code> table:</p><pre tabindex=0><code>$ ln -s ./ungrib/Variable_Tables/Vtable.ERA-interim.pl Vtable
</code></pre><h2 id=metgrid>metgrid</h2><p>Run metgrid.exe as usual.</p><h2 id=references>References</h2><ol><li><a href="https://valcap74.blogspot.com/2017/10/how-to-run-wrf-model-driven-by-era5-on.html?showComment=1524140953190#c5741939636532233503">How to run the WRF model using ERA5 (on model levels) as initial and boundary conditions</a></li><li><a href=https://software.ecmwf.int/wiki/display/OIFSUF/Grib+to+Netcdf+conversion>Grib to Netcdf conversion</a></li><li><a href=http://conorsweeneyucd.blogspot.com/2015/01/download-era-interim-data.html>Download ERA-Interim data</a></li><li><a href=http://www2.mmm.ucar.edu/wrf/OnLineTutorial/Basics/UNGRIB/ungrib_req_fields.php>UNGRIB: Required Fields</a></li></ol><h2 id=version-control>Version control</h2><table><thead><tr><th>Version</th><th>Action</th><th>Time</th></tr></thead><tbody><tr><td>1.0</td><td>Init</td><td>2019-10-03</td></tr><tr><td>1.1</td><td>Add support of selecting area</td><td>2019-10-04</td></tr><tr><td>1.2</td><td>Update the method of assigning &rsquo;time'</td><td>2020-03-27</td></tr></tbody></table></div><div class=row><div class=col-md-8><div class=mb-5><div class="li-x div-x post-meta"><li class=pr-0><a href=https://zxdawn.github.io/tags/><i class="fas fa-tags"></i></a></li><div class=tags-sm><li><a href=https://zxdawn.github.io/tags/era5 role=button>ERA5</a></li><li><a href=https://zxdawn.github.io/tags/wrf-chem role=button>WRF-Chem</a></li></div></div></div></div></div><div class="row pt-3"><div class=col-md-6><a href=https://zxdawn.github.io/2019/08/17/hugo-staticman-travis/ class=post-meta>Previous<div class="pt-2 pb-5 d-flex"><i class="fas fa-angle-left text-grey font-weight-bold mr-2 active-color"></i>
<span>Hugo+Staticman+Travis</span></div></a></div><div class="col-md-6 text-right"><a href=https://zxdawn.github.io/2019/12/20/ielts-notes/ class=post-meta>Next<div class="pt-2 pb-5 flex-reverse"><i class="fas fa-angle-right text-grey font-weight-bold ml-2 active-color"></i>
<span>IELTS Notes</span></div></a></div></div><section id=comments><hr><div id=comment-form><h3 id=comment-form-header>Say something</h3><form method=post action=https://ta1tk27bs2.execute-api.us-east-2.amazonaws.com/prod/v2/entry/zxdawn/zxdawn.github.io/main/comments><input type=hidden name=options[redirect] value=https://zxdawn.github.io/2019/10/03/initializing-the-wrf-model-with-era5-pressure-level/#comment-submitted>
<input type=hidden name=options[redirectError] value=https://zxdawn.github.io/2019/10/03/initializing-the-wrf-model-with-era5-pressure-level/#comment-error>
<input type=hidden name=options[slug] value=Initializing_the_WRF_model-with_ERA5_pressure_level>
<input type=hidden name=options[section] value=sci-tech>
<input type=hidden name=options[origin] value=https://zxdawn.github.io/2019/10/03/initializing-the-wrf-model-with-era5-pressure-level/>
<input type=hidden name=options[parent] value=Initializing_the_WRF_model-with_ERA5_pressure_level>
<input type=hidden name=fields[reply_to]>
<input type=address name=fields[botpot] placeholder="botpot (do not fill!)" style=display:none><fieldset><input name=fields[name] type=text placeholder="Your name"></fieldset><fieldset><input name=fields[email] type=email placeholder="Your email address"></fieldset><fieldset><textarea name=fields[body] placeholder="You can use Markdown syntax" rows=10></textarea></fieldset><fieldset><div class=notify-me><input type=checkbox id=comment-form-reply name=options[subscribe] value=email>
<label for=comment-form-reply>Send me an email when someone comments on this post.</label></div></fieldset><fieldset><input type=submit value=Submit id=submit-button class=right>
<input type=reset value=Reset class=right></fieldset></form></div><div id=comment-submitted class=dialog><h3>Thank you</h3><p>Your comment has been submitted and will be published once it has been approved.</p></div><div id=comment-error class=dialog><h3>OOPS!</h3><p>Your comment has not been submitted. Please <a href=https://zxdawn.github.io/2019/10/03/initializing-the-wrf-model-with-era5-pressure-level/>go back</a> and try again. Thank You!</p><p>If this error persists, please open an issue by <a href=https://github.com/zxdawn/zxdawn.github.io/issues>clicking here</a>.</p></div><h3>Comments (50)</h3><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/48f6b80bca28cd769e4cd6ceaa87f16e?s=70"></figure><p class=comment-info><strong>Sam</strong><br><small>Tuesday, Mar 24, 2020</small></p></header><div id=ce539e90-6d96-11ea-9d43-db10d1b1338d class=comment-thread><blockquote class=comment>Do I need to merge both dataset before running ungrib? If not what name I should give to each? GRIBFILE.AAA and GRIBFILE.AAB?</blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to Sam</i><br>Tuesday, Mar 24, 2020</small></p></header><div class=comment><p>Hi, Sam!</p><p>You don&rsquo;t have to merge both datasets.</p><p>You can just use <code>./link_grib.csh ERF5*</code> to link all files.</p><p>Then <code>ungrib.exe</code> will read all <code>GRIBFILE.*</code>.</p><p>Xin</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("ce539e90-6d96-11ea-9d43-db10d1b1338d","Sam")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/631cd553fcbf56e794632fba7282c1ed?s=70"></figure><p class=comment-info><strong>Zhenning Li</strong><br><small>Thursday, Mar 26, 2020</small></p></header><div id=2da3ac10-6f1c-11ea-8215-2961caefcb50 class=comment-thread><blockquote class=comment><p>Hi Xin,</p><p>Thanks for your great post. Very helpful!
Just one question, in your downloading py script, the specific time ranges from 00Z to 12Z, I am just wondering why 13-23Z were not selected?
Thanks</p><p>Zhenning</p></blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to Zhenning Li</i><br>Thursday, Mar 26, 2020</small></p></header><div class=comment><p>Hi Zhenning,</p><p>Thanks!</p><p>That&rsquo;s just an example which downloads 12 hours data.</p><p>You can choose any time interval you like, even unequally spaced intervals.</p><p>Xin</p></div></article><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to Zhenning Li</i><br>Friday, Mar 27, 2020</small></p></header><div class=comment><p>Hi Zhenning,</p><p>You can use a simpler method to choose the <code>time</code> like this:</p><pre tabindex=0><code>&#39;time&#39;:&#39;00/to/23/by/1&#39;,
</code></pre><p>I&rsquo;ve updated that part in the blog. Thank you for your question ;)</p><p>Xin</p></div></article><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/ac71aa5eb4502914605939e894572e1b?s=70"></figure><p class=comment-info><strong>Zhenning Li</strong><br><i><small>In reply to Zhenning Li</i><br>Saturday, May 1, 2021</small></p></header><div class=comment><p>Thanks! Sorry I just noted you reply. Good suggestion!</p><p>Regards,
Zhenning</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("2da3ac10-6f1c-11ea-8215-2961caefcb50","Zhenning Li")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/428416f4e58bc970ba2b3b68162fee22?s=70"></figure><p class=comment-info><strong>Prerita Agarwal</strong><br><small>Tuesday, Apr 7, 2020</small></p></header><div id=cd1456c0-78d9-11ea-8ca2-c35471e2764d class=comment-thread><blockquote class=comment><p>Hi Xin,</p><p>What is the exact difference between using model and pressure level data?</p><p>Also, does linking the grib files to folder like ./link_grib.csh ../DATA/ERA5 links both pressure and single-level data and does not need to be done separately?</p><p>Thanks, Prerita</p></blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to Prerita Agarwal</i><br>Tuesday, Apr 7, 2020</small></p></header><div class=comment><p>Hi Prerita,</p><p>A1:</p><p>The pressure levels are interpolated from model levels. You can check the <a href=https://confluence.ecmwf.int/display/CKB/ERA5%3A+data+documentation>ERA5 document</a> in detail. Also, the definition of 137 model levels is <a href=https://www.ecmwf.int/en/forecasts/documentation-and-support/137-model-levels>here</a> and the <a href=https://rda.ucar.edu/datasets/ds627.0/docs/Eta_coordinate/>diagram</a>.</p><p>A2:
Yes, you can link both kinds of data. That&rsquo;s easier to do <code>ungrib.exe</code> and <code>metgrid.exe</code>.</p><p>Cheers,
Xin</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("cd1456c0-78d9-11ea-8ca2-c35471e2764d","Prerita Agarwal")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/c8a21dc00051f8ff072b9a35abe2d75d?s=70"></figure><p class=comment-info><strong>Yasmin</strong><br><small>Sunday, Apr 12, 2020</small></p></header><div id=f1378a00-7c9d-11ea-8a94-d3c454f06e4a class=comment-thread><blockquote class=comment><p>Hi Xin,
With the older dataset (Era-Interim), between the steps ungrib.exe and metgrid.exe, you had to apply the calc_ecmwf_p.exe (<a href=https://metclim.ucd.ie/2018/03/wrfv3-9-1-with-era-interim-data-on-orr2/)>https://metclim.ucd.ie/2018/03/wrfv3-9-1-with-era-interim-data-on-orr2/)</a>. Is that not necessary anymore?</p><p>Thank you.</p></blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to Yasmin</i><br>Sunday, Apr 12, 2020</small></p></header><div class=comment><p>Hi Yasmin,</p><p>That step is related to the ERA5 <strong>model level</strong> data. For the <strong>pressure level</strong> data, you don&rsquo;t have to calculate data manually again.</p><p>Of course, I&rsquo;ve written <a href=https://dreambooker.site/2018/04/20/Initializing-the-WRF-model-with-ERA5/>another tutorial</a> for the <strong>model level</strong> data. Feel free to check that ;)</p><p>Xin</p></div></article><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/c8a21dc00051f8ff072b9a35abe2d75d?s=70"></figure><p class=comment-info><strong>Yasmin</strong><br><i><small>In reply to Yasmin</i><br>Thursday, Apr 16, 2020</small></p></header><div class=comment><p>Ahhh.. I see Xin, Thank you for the elucidation.
Which one do you recommend? Model or Pressure level data?</p><p>I am downloading the pressure data + surface data. Hopefully I can run successfully the WRF. Let&rsquo;s see.
Yasmin</p></div></article><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to Yasmin</i><br>Sunday, Apr 19, 2020</small></p></header><div class=comment><p>Hi Yasmin,</p><p>In my opinion, the pressure level data is enough. But, if you want the higher vertical resolution, such as >100 levels, or focus on upper atmosphere, you can try the model data.</p><p>Looking forward to your test ;)</p><p>Xin</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("f1378a00-7c9d-11ea-8a94-d3c454f06e4a","Yasmin")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/c8a21dc00051f8ff072b9a35abe2d75d?s=70"></figure><p class=comment-info><strong>Yasmin</strong><br><small>Sunday, Apr 19, 2020</small></p></header><div id=5eb8ebe0-8285-11ea-9b82-c5048cc5491f class=comment-thread><blockquote class=comment><p>Hi again Xin,
So I just downloaded my data and performed a test, however I got the error relate to the Pressure levels, I guess I need to use the calc_ecmwf_p.exe
Do you know where I can find the ecmwf_coeffs table for 38 pressure levels?</p><p>WARNING: Couldn&rsquo;t open file PRES:2019-11-02_00 for input.
Processing 2019-11-02_06
FILE
PRES</p></blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to Yasmin</i><br>Monday, Apr 20, 2020</small></p></header><div class=comment><p>Hi Yasmin,</p><p>I&rsquo;ve used the ERA5 pressure level data several times and it always works well. So, I suppose there&rsquo;s something wrong in your step of <code>./link_grib.csh</code> or <code>ungrib.exe</code>. You need to check files (<code>GRIBFILE.AAA</code> &mldr;&mldr;) and logs (<code>ungrib.log</code>) related to these two command. If these steps are successful, then you should see the <code>FILE:**</code> files which cover the simulation time duration.</p><p>The most possible cause is the <code>namelist.wps</code>, you don&rsquo;t need <code>PRES</code>. Here&rsquo;s an example:</p><pre tabindex=0><code>&amp;ungrib
 out_format                         = &#39;WPS&#39;,
 prefix                             = &#39;FILE&#39;,
 /

&amp;metgrid
 fg_name                            = &#39;FILE&#39;,
 io_form_metgrid                    = 2,
 /
</code></pre><p>Xin</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("5eb8ebe0-8285-11ea-9b82-c5048cc5491f","Yasmin")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/c8a21dc00051f8ff072b9a35abe2d75d?s=70"></figure><p class=comment-info><strong>Yasmin</strong><br><small>Monday, Apr 20, 2020</small></p></header><div id=4eaa5860-82cb-11ea-a747-75be62c6867c class=comment-thread><blockquote class=comment>Hey Xin,
You were right, The problem was in the namelist.wps, which I didnt remove the fg_nam = &lsquo;PRES&rsquo; (I&rsquo;ve copied it from past simulations that I did using ERA-Interim). My simulations are already running. Thank you very much. Hopefully this dataset will provide results as good as the Era-Interim =)</blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to Yasmin</i><br>Tuesday, Apr 21, 2020</small></p></header><div class=comment><p>Great! Looking forward to your new results ;)</p><p>Xin</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("4eaa5860-82cb-11ea-a747-75be62c6867c","Yasmin")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/f534b138894289dde29801ca01120947?s=70"></figure><p class=comment-info><strong>Guilherme</strong><br><small>Tuesday, Apr 21, 2020</small></p></header><div id=8952af00-836e-11ea-bcb0-73c9c53a4565 class=comment-thread><blockquote class=comment><p>Hi Xin,
After i run the command &ldquo;calc_ecmwf_p.exe&rdquo;, the following error appears:</p><p>ERROR: Error opening ecmwf_coeffs
Reading from FILE at time 2016-10-17_00
Found PSFC field in FILE:2016-10-17_00
WARNING: Either TT or SPECHUMD not found. No RH will be computed&mldr;
&mldr;
&mldr;
&mldr;
Any idea?
Thank you!</p></blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to Guilherme</i><br>Tuesday, Apr 21, 2020</small></p></header><div class=comment><p>Hi,</p><p>Note that the step of <code>calc_ecmwf_p.exe</code> is necessary for model level data, not pressure data.</p><p>If you&rsquo;re using model level data, you need to create <code>ecmwf_coeffs</code> by yourself. Please check my <a href=https://dreambooker.site/2018/04/20/Initializing-the-WRF-model-with-ERA5/>another tutorial</a>.</p><p>Xin</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("8952af00-836e-11ea-bcb0-73c9c53a4565","Guilherme")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/d22e0f8a206d8bee7ca12d2c1afebac1?s=70"></figure><p class=comment-info><strong>Stefan Rahimi</strong><br><small>Friday, Jun 26, 2020</small></p></header><div id=75ed8750-b7c6-11ea-93e1-dda4b3474453 class=comment-thread><blockquote class=comment><p>Dear Xin,</p><p>Thank you for this wonderful tutorial. I just have one question.</p><p>Where are you downloading these data from? ERA5 data are on the CISL RDA (<a href=https://rda.ucar.edu/datasets/ds630.0/)>https://rda.ucar.edu/datasets/ds630.0/)</a>, but the data are not in discrete time slices as required by ungrib.exe. I am planning to downscale ERA5 for a 40-year period, so I am trying to find grb files that are date-time specific&mldr;</p><p>It looks like the above scripts nicely subset the data and pull relevant variables into new grb files?</p><p>Thanks,
-Stefan Rahimi, UCLA</p></blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to Stefan Rahimi</i><br>Saturday, Jun 27, 2020</small></p></header><div class=comment><p>Dear Stefan,</p><p>The resource is from CDS which contains ERA5 <a href="https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-pressure-levels?tab=overview">Pressure level data</a> and <a href="https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-single-levels?tab=overview">Single level data</a>.</p><p>Since you need 40-year data, you can choose either method: using the above scripts or just clicking the boxes on the CDS web page.</p><p>Regards,
Xin</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("75ed8750-b7c6-11ea-93e1-dda4b3474453","Stefan Rahimi")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/42665cb945b43c65c85b82d1e5f8865f?s=70"></figure><p class=comment-info><strong>bara</strong><br><small>Friday, Jun 26, 2020</small></p></header><div id=9f17e990-b7cb-11ea-9e0b-bbcb9fdcfd5a class=comment-thread><blockquote class=comment><p>Hi Xin
Thank you for your nice tutorial.
I have followed all steps ,but I did not get the verticale levels for 4-dimensional variables like relative humidity (RH) and temperature (TT)) in my met file ( met_em.d01.2018-06-28_18:00:00.nc example)</p><p>How to solve this problem?</p><p>bara</p></blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to bara</i><br>Saturday, Jun 27, 2020</small></p></header><div class=comment><p>Hi Bara,</p><p>That&rsquo;s strange &mldr;</p><p>Could you check whether <code>RH</code> and <code>TT</code> exist in the pressure level grib files you have downloaded?</p><p>BTW, it;s better to make sure there&rsquo;s no error in the log files (<strong>ungrib.log</strong> and <strong>metgrid.log</strong>).</p><p>Xin</p></div></article><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/42665cb945b43c65c85b82d1e5f8865f?s=70"></figure><p class=comment-info><strong>Bara</strong><br><i><small>In reply to bara</i><br>Saturday, Jun 27, 2020</small></p></header><div class=comment>Hi Xin!
Thank you for your quick reply
I checked the downloaded files but they contain pressure levels for UU, TT &mldr;.
But the problem in coming from ungrib.exe and metgrid.exe. Files created by these both executables have not pressure levels.
Do you have any idea please</div></article><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to bara</i><br>Sunday, Jun 28, 2020</small></p></header><div class=comment><p>Hi Bara,</p><p>Could you send the log files to my [email](mailto: <a href=mailto:xinzhang1215@gmail.com>xinzhang1215@gmail.com</a>)? (If the generated files aren&rsquo;t big, you can send them too) So, I can check the details &mldr;</p><p>Xin</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("9f17e990-b7cb-11ea-9e0b-bbcb9fdcfd5a","bara")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/42665cb945b43c65c85b82d1e5f8865f?s=70"></figure><p class=comment-info><strong>Bara</strong><br><small>Tuesday, Jun 30, 2020</small></p></header><div id=e64e4990-bac7-11ea-acb2-2b32eb635b36 class=comment-thread><blockquote class=comment><p>Hi Xin,
I really appreciated your collaboration.
Finally, I have solved the problem by adding the following code to the 38 pressure levels:</p><p>echo &lsquo;write &ldquo;[centre]<em>[dataDate]</em>[dataType]<em>[levelType]</em>[step].grib[edition]&rdquo;;&rsquo; > split.rule
grib_filter split.rule ERA5-${DATE1}-${DATE2}-sfc.grb
grib_set -s deletePV=1,edition=1 ERA5-${DATE1}-${DATE2}-ml.grb ERA5-${DATE1}-${DATE2}-ml.grib1
grib_filter split.rule ERA5-${DATE1}-${DATE2}-ml.grib1</p><p>This code is the last step for bash program for your 138 model levels tutorial.</p><p>Bara</p></blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to Bara</i><br>Tuesday, Jun 30, 2020</small></p></header><div class=comment><p>Ha, nice!</p><p>I thought that step was optional for pressure level data and never used that before &mldr;</p><p>Anyway, I&rsquo;m glad you solved it ;)</p><p>Xin</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("e64e4990-bac7-11ea-acb2-2b32eb635b36","Bara")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/3c30eb5b3996b4a1e77ef76a1f6de341?s=70"></figure><p class=comment-info><strong>Chi</strong><br><small>Friday, Jul 3, 2020</small></p></header><div id=9c2a8dd0-bcd2-11ea-941d-cde4e256f700 class=comment-thread><blockquote class=comment><p>Hi Xin, thanks for your tutorial, and I have some questions.
I&rsquo;m ungribbing ERA-Interim data(pressure level), can I use SH, 2m T and 2m dewpoint T to calculate RH by adding SPECHUMD to the Vtable.ECMWF?
I noticed this RH data are different from ungribbing it directly with ERA-Interim RH data in met files, what could be the problem?</p><p>Chi</p></blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to Chi</i><br>Friday, Jul 3, 2020</small></p></header><div class=comment><p>Hi Chi,</p><p>This post is for ERA5 dataset.</p><p>If you&rsquo;re using <strong>ERA-Interim</strong> data, please check my <a href=https://dreambooker.site/2017/12/20/Initializing-the-WRF-model-with-ECMWF-ERA-Interim-reanalysis/>another post</a>.</p><p>Xin</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("9c2a8dd0-bcd2-11ea-941d-cde4e256f700","Chi")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/9d98c3b567198430b7875d1fa645dace?s=70"></figure><p class=comment-info><strong>Bart Brashers</strong><br><small>Sunday, Jul 5, 2020</small></p></header><div id=d81bac70-bf07-11ea-b4a4-eb86dc72cfa1 class=comment-thread><blockquote class=comment><p>Would it be beneficial to add &lsquo;geopotential&rsquo; to the GetERA5-sl.py part of the code? That would download GRIB code=129, level code=1 (surface), which WRF uses to construct SOILGEO and SOILHGT. [url]https://confluence.ecmwf.int/pages/viewpage.action?pageId=82870405#ERA5:datadocumentation-Table1[/url] says it&rsquo;s available.</p><p>Back when I first stated using ERA-Interim for WRF I constructed an invariant SOILGEO file, so why not for ERA5?</p></blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to Bart Brashers</i><br>Monday, Jul 6, 2020</small></p></header><div class=comment><p>Thanks, Bart. Nice question!</p><p>I can&rsquo;t find the <code>soil height</code> variable in the ERA5 dataset &mldr;</p><p>Have you found it on the CDS website?</p><p>Regards,</p><p>Xin</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("d81bac70-bf07-11ea-b4a4-eb86dc72cfa1","Bart Brashers")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8eb505a449d0cf56e83381b4edcf54b7?s=70"></figure><p class=comment-info><strong>Du Xin-guan</strong><br><small>Monday, Jul 6, 2020</small></p></header><div id=fd17a7a0-bf56-11ea-99e5-edd9ad172cb8 class=comment-thread><blockquote class=comment><p>Dear Xin,</p><p>When i do ungrib.exe, I can ungrib pressure-level ERA5 data, but I can not ungrib surface ERA5 data. It was said that &lsquo;was expecting a Grib1 file , but this is a Grib2 file. It is possible this is because your GRIBFILE.XXX files are not all of the same type. '</p><p>I will appreciate your any suggestions.</p><p>Du</p></blockquote><div class=comment-reply-button><input id=fd17a7a0-bf56-11ea-99e5-edd9ad172cb8 type=button class=right value="Reply to Du Xin-guan" onclick='replyTo("fd17a7a0-bf56-11ea-99e5-edd9ad172cb8","Du Xin-guan")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/76291b429754b2cf4c7254605db18e9a?s=70"></figure><p class=comment-info><strong>Jason</strong><br><small>Friday, Aug 7, 2020</small></p></header><div id=92bba4b0-d847-11ea-a74c-3be975a6e4b3 class=comment-thread><blockquote class=comment><p>Hi Xin! your tutorial did help me a lot!
I used WRFdomainWizard to run WRF, and I found that, in the namelist.wps, the levels seem to be strange:</p><p>&amp;mod_levs
press_pa = 201300 , 200100 , 100000 ,
95000 , 90000 ,
85000 , 80000 ,
75000 , 70000 ,
65000 , 60000 ,
55000 , 50000 ,
45000 , 40000 ,
35000 , 30000 ,
25000 , 20000 ,
15000 , 10000 ,
5000 , 1000</p><p>If I don&rsquo;t use WRFdomainWizard to run WRF, the original namelist.wps doesn&rsquo;t have content about &amp;mod_levs. Should I set this before run WPS? If I should set this, what array should I input (pressure data)?</p></blockquote><div class=comment-reply-button><input id=92bba4b0-d847-11ea-a74c-3be975a6e4b3 type=button class=right value="Reply to Jason" onclick='replyTo("92bba4b0-d847-11ea-a74c-3be975a6e4b3","Jason")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/db2f676a1260798d255cb762a5a4a960?s=70"></figure><p class=comment-info><strong>Sumitra</strong><br><small>Friday, Aug 7, 2020</small></p></header><div id=347ad600-d8bf-11ea-b408-6bcca38cf5cb class=comment-thread><blockquote class=comment><h2 id=mismatch_landmask_ivgtyp>HI Xin!
I followed the steps you mentioned in this post, now I am getting error while running the command ./real.exe.
&mdash;&mdash;&mdash;&mdash;&ndash; FATAL CALLED &mdash;&mdash;&mdash;&mdash;&mdash;
FATAL CALLED FROM FILE: LINE: 3388
mismatch_landmask_ivgtyp</h2><p>Thank you</blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/?s=70"></figure><p class=comment-info><strong>pyadav</strong><br><i><small>In reply to Sumitra</i><br>Monday, Aug 31, 2020</small></p></header><div class=comment>hi xin this error i am also getting &lsquo;mismatch_landmask_ivgtyp&rsquo;, while real run please reply</div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("347ad600-d8bf-11ea-b408-6bcca38cf5cb","Sumitra")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/eebf4c2850298fe5549d62125d848694?s=70"></figure><p class=comment-info><strong>Josué Arellano Palacios</strong><br><small>Wednesday, Sep 9, 2020</small></p></header><div id=a34aee40-f24a-11ea-bcf0-bd986a5b2e26 class=comment-thread><blockquote class=comment><p>Hi Xin! How are you? first thanks for the tutorial, so I have followed all steps and when I do wrf.exe I get this:</p><p>FATAL CALLED FROM FILE: LINE: 242
program wrf: error opening wrfrst_d01_2001-10-01_00:00:00 for reading</p><p>What could have gone wrong?</p></blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to Josué Arellano Palacios</i><br>Wednesday, Sep 9, 2020</small></p></header><div class=comment><p>Hi Josué,</p><p>This is caused by the <code>restart</code> option in the <code>namelist.input</code> file.</p><p>If you don&rsquo;t want restart, you can set it to <strong>False</strong>. Otherwise, you have to set the suitable <code>restart_interval</code> for the restart.</p><p>You can check the official WRF USER GUIDE in detail.</p><p>Regards,</p><p>Xin</p></div></article><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/eebf4c2850298fe5549d62125d848694?s=70"></figure><p class=comment-info><strong>Josué Arellano Palacios</strong><br><i><small>In reply to Josué Arellano Palacios</i><br>Friday, Sep 18, 2020</small></p></header><div class=comment><p>Thanks for your help, it was very useful! Your tutorial is great!</p><p>Best,</p><p>Josué</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("a34aee40-f24a-11ea-bcf0-bd986a5b2e26","Josué Arellano Palacios")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/216deb41dbefd272ac3b188eb2fb65c6?s=70"></figure><p class=comment-info><strong>He Ming</strong><br><small>Tuesday, Oct 20, 2020</small></p></header><div id=973ce810-12d4-11eb-beeb-979d191e7a1c class=comment-thread><blockquote class=comment><p>hi Xin~
i have meet some troubles when i wrong WRF3.8. i followed all of the steps to download ERA5 data and it wroks. But it only runs several seconds and then stopped after i submit the job.
i check .err file and found:
mpirun has exited due to process rank 13 with PID 60264 on
node h2ocn16 exiting improperly. There are two reasons this could occur:</p><ol><li><p>this process did not call &ldquo;init&rdquo; before exiting, but others in
the job did. This can cause a job to hang indefinitely while it waits
for all processes to call &ldquo;init&rdquo;. By rule, if one process calls &ldquo;init&rdquo;,
then ALL processes must call &ldquo;init&rdquo; prior to termination.</p></li><li><p>this process called &ldquo;init&rdquo;, but exited without calling &ldquo;finalize&rdquo;.
By rule, all processes that call &ldquo;init&rdquo; MUST call &ldquo;finalize&rdquo; prior to
exiting or it will be considered an &ldquo;abnormal termination&rdquo;</p></li></ol><p>This may have caused other processes in the application to be
terminated by signals sent by mpirun (as reported here).</p><p>how can fix this problem ?
thanks !</p></blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to He Ming</i><br>Thursday, Oct 22, 2020</small></p></header><div class=comment><p>Hi, He Ming,</p><p>You can check the detailed log (rsl.error.****) related to that specific node (node h2ocn16).</p><p>That should contain the information you want.</p><p>Anyway, it seems not the problem of ERA5 data, but the setting of WRF.</p><p>Xin</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("973ce810-12d4-11eb-beeb-979d191e7a1c","He Ming")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/de1d66040ea8c3d030f74ae37c4c1b11?s=70"></figure><p class=comment-info><strong>Divyansh Chug</strong><br><small>Thursday, Oct 22, 2020</small></p></header><div id=5b129310-14a7-11eb-a3d8-0bb087667051 class=comment-thread><blockquote class=comment>Thank you so much Xin Zhang for documenting this process!</blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to Divyansh Chug</i><br>Sunday, Oct 25, 2020</small></p></header><div class=comment><p>You&rsquo;re welcome, Divyansh Chug.</p><p>I&rsquo;m glad that this can help you ;)</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("5b129310-14a7-11eb-a3d8-0bb087667051","Divyansh Chug")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/bf52802885e3d220658d82960a4a3cad?s=70"></figure><p class=comment-info><strong>joseph</strong><br><small>Friday, Nov 27, 2020</small></p></header><div id=3f07ab70-307b-11eb-a2d0-5d5223ad6477 class=comment-thread><blockquote class=comment>Do you have python script to download monthly averaged reanalysis? Thanks.</blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to joseph</i><br>Friday, Nov 27, 2020</small></p></header><div class=comment><p>I haven&rsquo;t used the monthly data before.</p><p>But, you can generate the official script on the CDS page and then write your own based on that.</p><p>Regards,
Xin</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("3f07ab70-307b-11eb-a2d0-5d5223ad6477","joseph")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/0134fc13532cf9718692384db29d712d?s=70"></figure><p class=comment-info><strong>Peng</strong><br><small>Friday, Dec 25, 2020</small></p></header><div id=38b9b960-46b6-11eb-ae6d-1b52733c471b class=comment-thread><blockquote class=comment>Hi Xin,
Thank you very much for this wonderful tutorial!
Does ERA5 provide a forecast field data with which I can do a forecast rather than a simulation? I will set the forecast field data as the boundary forcing data.</blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to Peng</i><br>Saturday, Dec 26, 2020</small></p></header><div class=comment><p>Hi Peng,</p><p>You can check the free ERA5 products <a href="https://apps.ecmwf.int/data-catalogues/era5/?class=ea">here</a>.</p><p>I suppose the real-time forecast data isn&rsquo;t freely available.</p><p>Regards,</p><p>Xin</p></div></article><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/0134fc13532cf9718692384db29d712d?s=70"></figure><p class=comment-info><strong>Peng</strong><br><i><small>In reply to Peng</i><br>Saturday, Dec 26, 2020</small></p></header><div class=comment><p>Thank you very much for your reply.</p><p>Kind regards,
Peng</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("38b9b960-46b6-11eb-ae6d-1b52733c471b","Peng")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/0134fc13532cf9718692384db29d712d?s=70"></figure><p class=comment-info><strong>peng</strong><br><small>Thursday, Dec 31, 2020</small></p></header><div id=7db5a450-4b13-11eb-945c-01fd14c1c8ac class=comment-thread><blockquote class=comment><p>Hi Xin,</p><p>Sorry to bother you again.
Thanks very much for your wonderful tutorial to enable me to run WRF successfully with ERA5 reanalysis data. But error happened when I used the forecast field data as the boundary forcing condition. Error is as follows when running the ungrib.exe,</p><p>&ldquo;Unknown Data Representation Type, ksec2(4)= 50 "</p><p>Do you have any idea to solve this problem?</p><p>Happy new year!
Peng</p></blockquote><div class=comment-reply-button><input id=7db5a450-4b13-11eb-945c-01fd14c1c8ac type=button class=right value="Reply to peng" onclick='replyTo("7db5a450-4b13-11eb-945c-01fd14c1c8ac","peng")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/5466b7e1600f003cf047edcf969c60d1?s=70"></figure><p class=comment-info><strong>Vinayak</strong><br><small>Sunday, Apr 11, 2021</small></p></header><div id=c71087f0-9af0-11eb-9eba-b12b45be727a class=comment-thread><blockquote class=comment>Hi Xin,
I came across your very informative blog recently. I wanted to know whether we can use ERA-Interim Subsets to force WRF. When I tried forcing the subset from rda ucar website. metgrid.exe throws &ldquo;Gaussian Latittude Computation Error&rdquo;. Other blogs are suggesting to download global data which is humongous and takes a lot of time. I want simulations only on my study region. Can you suggest any alternative or detailed tutorial to use ERA-INterim subsets with WRF??</blockquote><div style=clear:both></div><article class=comment-reply><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/8dc0f26bcc80769c2e9117e17c12a212?s=70"></figure><p class=comment-info><strong>Xin Zhang</strong><br><i><small>In reply to Vinayak</i><br>Tuesday, Apr 13, 2021</small></p></header><div class=comment><p>Hi Vinayak,</p><p>You can check my other <a href=https://dreambooker.site/2017/12/20/Initializing-the-WRF-model-with-ECMWF-ERA-Interim-reanalysis/>tutorial</a> about ERA-Interim. Hope that can help you.</p><p>Xin</p></div></article><div class=comment-reply-button-reply><input type=button class=right value="Reply to Thread" onclick='replyTo("c71087f0-9af0-11eb-9eba-b12b45be727a","Vinayak")'></div><div style=clear:both></div></div></article><article><header class=comment-header><figure class="frame comment-avatar"><img class=comment-avatar src="https://www.gravatar.com/avatar/57f49714fbca0922598d5908da4ae501?s=70"></figure><p class=comment-info><strong>Rocio</strong><br><small>Tuesday, May 11, 2021</small></p></header><div id=108be480-b2aa-11eb-a7d9-d316766566dc class=comment-thread><blockquote class=comment><p>Hi!
I&rsquo;m having this error after I run the metgrid.exe. Do you know what could be the reason?</p><p>ARNING: Field PRES has missing values at level 200100 at (i,j)=(1,1)
WARNING: Field PMSL has missing values at level 200100 at (i,j)=(1,1)
WARNING: Field PSFC has missing values at level 200100 at (i,j)=(1,1)</p><p>Regards,
Rocío</p></blockquote><div class=comment-reply-button><input id=108be480-b2aa-11eb-a7d9-d316766566dc type=button class=right value="Reply to Rocio" onclick='replyTo("108be480-b2aa-11eb-a7d9-d316766566dc","Rocio")'></div><div style=clear:both></div></div></article></section></div></div><div class="col-md-2 pl-0"><div id=page-scrollspy class=toc-nav><ul class="nav nav-pills ml-0"><li class="nav-item pb-3 text-center"><span class="font-weight-bold mb-2">- CATALOG -</span></li><ul class=nav><li class=nav-item><a class=nav-link href=#note>Note</a></li></ul><ul class=nav><li class=nav-item><a class=nav-link href=#required-fields>Required Fields</a></li></ul><ul class=nav><ul class=nav><li class=nav-item><a class=nav-link href=#single-level-data-getera5-slpy>Single level data (GetERA5-sl.py)</a></li></ul></ul><ul class=nav><ul class=nav><li class=nav-item><a class=nav-link href=#pressure-level-data-getera5-plpy>Pressure level data (GetERA5-pl.py)</a></li></ul></ul><ul class=nav><li class=nav-item><a class=nav-link href=#automation-script-download>Automation script (Download)</a></li></ul><ul class=nav><li class=nav-item><a class=nav-link href=#geogrid>geogrid</a></li></ul><ul class=nav><li class=nav-item><a class=nav-link href=#ungrib>ungrib</a></li></ul><ul class=nav><li class=nav-item><a class=nav-link href=#metgrid>metgrid</a></li></ul><ul class=nav><li class=nav-item><a class=nav-link href=#references>References</a></li></ul><ul class=nav><li class=nav-item><a class=nav-link href=#version-control>Version control</a></li></ul></ul></div></div></div></main><script src=https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js></script>
<script>addBackToTop({diameter:56,backgroundColor:"rgb(255, 82, 82)",textColor:"#fff"})</script><footer class="page-footer text-center font-small mt-4 wow fadeIn"><div class="pb-2 mt-5 pt-5"><a href=//github.com/zxdawn target=_blank rel="noopener me"><i class="fab fa-github pr-1" aria-hidden=true></i></a>
<a href=//twitter.com/zhangxin_dawn target=_blank rel="noopener me"><i class="fab fa-twitter pr-1" aria-hidden=true></i></a>
<a href=//instagram.com/zhangxin_dawn/ target=_blank rel="noopener me"><i class="fab fa-instagram pr-1" aria-hidden=true></i></a>
<a href=mailto:xinzhang1215@gmail.com><i class="far fa-envelope-open pr-1" aria-hidden=true></i></a></div><div class="copyright py-4"><span>2016 - 2023 &copy; | Theme <a href=https://github.com/EliiseS/AllinOne target=_blank>AllinOne</a></span></div></footer><script type=text/javascript src=https://zxdawn.github.io/js/vendors/jquery/jquery-3.3.1.min.js></script>
<script type=text/javascript src=https://zxdawn.github.io/js/vendors/jquery/jquery.smooth-scroll.min.js></script>
<script type=text/javascript src=https://zxdawn.github.io/js/vendors/popper.min.js></script>
<script type=text/javascript src=https://zxdawn.github.io/js/vendors/holder.min.js></script>
<script type=text/javascript src=https://zxdawn.github.io/js/vendors-extensions/bootstrap4/bootstrap.min.js></script>
<script type=text/javascript src=https://zxdawn.github.io/js/vendors/mdb/mdb.min.js></script>
<script type=text/javascript src=https://zxdawn.github.io/js/main.js></script>
<script src=https://zxdawn.github.io/js/vendors/highlight.pack.js></script><script>hljs.initHighlightingOnLoad()</script><script type=text/javascript>(new WOW).init()</script><script src=https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js></script>
<script>addBackToTop({diameter:56,backgroundColor:"rgb(255, 82, 82)",textColor:"#fff"})</script></body></html>